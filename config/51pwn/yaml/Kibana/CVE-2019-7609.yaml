id: CVE-2019-7609
info:
  name: Kibana Timelion - Arbitrary Code Execution
  author:
  - l0ne1y
  description: |-
    Elasticsearch Kibana 命令注入漏洞
    Elasticsearch Kibana是荷兰Elasticsearch公司的一套开源的、基于浏览器的分析和搜索Elasticsearch仪表板工具。

    Kibana 5.6.15之前版本和6.6.1之前版本中的Timelion visualizer存在安全漏洞。远程攻击者可通过发送请求利用该漏洞执行JavaScript代码并可能以Kibana进程权限执行任意命令。
  severity: critical
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://www.elastic.co/cn/community/security

    临时修复方案：
    1、可以通过在kibana.yml配置文件中将timelion.enabled设置为false来禁用Timelion。
requests:
- matchers:
  - type: word
    part: body
    words:
    - seriesList
  - type: word
    part: header
    words:
    - application/json
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/api/timelion/run'
  method: POST
  body: '{"sheet":[".es(*)"],"time":{"from":"now-1m","to":"now","mode":"quick","interval":"auto","timezone":"Asia/Shanghai"}}'
  headers:
    Content-Type: application/json; charset=utf-8
