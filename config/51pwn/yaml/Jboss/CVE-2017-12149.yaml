id: CVE-2017-12149
info:
  name: Jboss Application Server - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    JBoss AS 6.X 反序列化漏洞
    该漏洞位于JBoss的HttpInvoker组件中的 ReadOnlyAccessFilter 过滤器中，其doFilter方法在没有进行任何安全检查和限制的情况下尝试将来自客户端的序列化数据流进行反序列化，导致攻击者可以通过精心设计的序列化数据来执行任意代码。但近期有安全研究者发现JBOSSAS 6.x也受该漏洞影响，攻击者利用该漏洞无需用户验证在系统上执行任意命令，获得服务器的控制权
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议升级到JBOSS AS7,补丁获取链接：
    https://jbossweb.jboss.org/
    临时修复方案：
    1、 不需要 http-invoker.sar 组件的用户可直接删除此组件
    2、 添加如下代码至 http-invoker.sar 下 web.xml 的 security-constraint 标签中：<url-pattern>/*</url-pattern>用于对 http invoker 组件进行访问控制。
requests:
- matchers:
  - type: word
    part: body
    words:
    - ClassCastException
  - type: word
    part: header
    words:
    - application/x-java-serialized-object
  matchers-condition: and
  raw:
  - |
    POST /invoker/JMXInvokerServlet/ HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/octet-stream

    {{ base64_decode("rO0ABXNyABNqYXZhLnV0aWwuQXJyYXlMaXN0eIHSHZnHYZ0DAAFJAARzaXpleHAAAAACdwQAAAACdAAJZWxlbWVudCAxdAAJZWxlbWVudCAyeA==") }}
  - |
    POST /invoker/EJBInvokerServlet/ HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/octet-stream

    {{ base64_decode("rO0ABXNyABNqYXZhLnV0aWwuQXJyYXlMaXN0eIHSHZnHYZ0DAAFJAARzaXpleHAAAAACdwQAAAACdAAJZWxlbWVudCAxdAAJZWxlbWVudCAyeA==") }}
