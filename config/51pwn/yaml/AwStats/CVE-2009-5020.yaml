id: CVE-2009-5020
info:
  name: AWStats < 6.95 - Open Redirect
  author:
  - l0ne1y
  description: |-
    AWStats awredir.pl文件URL重定向漏洞
    AwStats 是一款基于Web的网站访问统计程序。

    AWStats 6.95之前版本中的awredir.pl文件中存在开放重定向漏洞。远程攻击者可以借助未明向量将用户重定向到任意站点并进行钓鱼攻击。
  severity: medium
  remediation: |2-

    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    http://awstats.sourceforge.net/

    临时修复方案：
    1、代码固定跳转地址，不让用户控制变量。
    2、跳转目标地址采用白名单映射机制、只对合法的 URL 做跳转。
    3、合理充分的校验校验跳转的目标地址，非己方地址时告知用户跳转风险。
requests:
- matchers:
  - type: regex
    part: header
    regex:
    - (?m)^(?:Location\s*?:\s*?)(?:https?:\/\/|\/\/|\/\\\\|\/\\)?(?:[a-zA-Z0-9\-_\.@]*)bing\.com\/?(\/|[^.].*)?$
  path:
  - '{{BaseURL}}/awstats/awredir.pl?url=bing.com'
  - '{{BaseURL}}/cgi-bin/awstats/awredir.pl?url=bing.com'
  method: GET
  stop-at-first-match: true
