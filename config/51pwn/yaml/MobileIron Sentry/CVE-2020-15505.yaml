id: CVE-2020-15505
info:
  name: MobileIron Core & Connector <= v10.6 & Sentry <= v9.8 - Remote Code Execution
  author:
  - dwisiswant0
  tags:
  - cve
  - cve2020
  - mobileiron
  - rce
  - sentry
  description: "多款MobileIron产品安全漏洞\n MobileIron Sentry和MobileIron Core都是美国思可信（MobileIron）公司的产品。Sentry是一款智能网关产品。MobileIron
    Core是一款MobileIron平台的管理控制台组件。该产品支持为设备、应用程序和内容定义安全和管理策略。\n\nMobileIron Core 10.6及之前版本、Connector
    10.6及之前版本和Sentry 9.8及之前版本中存在安全漏洞。远程攻击者可利用该漏洞执行任意代码。 "
  reference:
  - https://blog.orange.tw/2020/09/how-i-hacked-facebook-again-mobileiron-mdm-rce.html
  - https://github.com/iamnoooob/cve-reverse/tree/master/cve-2020-15505
  - https://github.com/iamnoooob/cve-reverse/blob/master/cve-2020-15505/hessian.py#l10
  - https://github.com/orangetw/jndi-injection-bypass
  - https://nvd.nist.gov/vuln/detail/cve-2020-15505
  severity: critical
  classification:
    cve-id:
    - cve-2020-15505
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    官方修复方案：<br />1、升级系统至无漏洞版本，或于官网下载安全补丁。
    https://www.mobileiron.com/en/blog/mobileiron-security-updates-available

    临时修复方案：<br />1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。<br />2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: word
    part: header
    words:
    - application/x-hessian
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /mifs/.;/services/LogService HTTP/1.1
    Host: {{Hostname}}
    Referer: https://{{Hostname}}
    Content-Type: x-application/hessian
    Connection: close

    {{hex_decode('630200480004')}}
