id: CVE-2020-16846
info:
  name: SaltStack <=3002 - Shell Injection
  author:
  - l0ne1y
  tags:
  - cve
  - cve2020
  - saltstack
  description: |-
    Saltstack SSH Client Salt API 命令执行漏洞
    SaltStack Salt是SaltStack公司的一套开源的用于管理基础架构的工具。该工具提供配置管理、远程执行等功能。

    SaltStack Salt中的API 存在操作系统命令注入漏洞，该漏洞允许攻击者绕过限制，以提升其特权。
  reference:
  - https://saltproject.io/on-november-3-2020-saltstack-publicly-disclosed-three-new-cves/
  - https://mp.weixin.qq.com/s/r8qw_lwizgyejs0jocyxag
  - https://github.com/vulhub/vulhub/tree/master/saltstack/cve-2020-16846
  - https://nvd.nist.gov/vuln/detail/cve-2020-16846
  severity: critical
  classification:
    cve-id:
    - cve-2020-16846
    cwe-id:
    - cwe-78
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    官方修复方案：
    1.目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://gitlab.com/saltstack/open/salt-patches/-/commit/a8b998ae07dbf752cbd6a1d1cdcdcc366bffb04e
requests:
- matchers:
  - type: status
    status:
    - 500
  - type: word
    part: header
    words:
    - application/json
  - type: word
    part: body
    words:
    - An unexpected error occurred
  matchers-condition: and
  path:
  - '{{BaseURL}}/run'
  method: POST
  body: token=1337&client=ssh&tgt=*&fun=a&roster=projectdiscovery&ssh_priv=nuclei
  headers:
    Content-Type: application/x-www-form-urlencoded
